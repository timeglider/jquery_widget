/*

 // Underscore.js 1.1.7
 // (c) 2011 Jeremy Ashkenas, DocumentCloud Inc.
 // Underscore is freely distributable under the MIT license.
 // Portions of Underscore are inspired or borrowed from Prototype,
 // Oliver Steele's Functional, and John Resig's Micro-Templating.
 // For all details and documentation:
 // http://documentcloud.github.com/underscore
*/
(function(){var s=this,D=s._,A={},q=Array.prototype,E=Object.prototype,z=q.slice,H=q.unshift,v=E.toString,o=E.hasOwnProperty,j=q.forEach,w=q.map,e=q.reduce,n=q.reduceRight,t=q.filter,y=q.every,G=q.some,d=q.indexOf,l=q.lastIndexOf;E=Array.isArray;var p=Object.keys,b=Function.prototype.bind,a=function(c){return new r(c)};typeof module!=="undefined"&&module.exports?(module.exports=a,a._=a):s._=a;a.VERSION="1.1.7";var k=a.each=a.forEach=function(c,f,m){if(c!=null)if(j&&c.forEach===j)c.forEach(f,m);else if(c.length===
+c.length)for(var x=0,C=c.length;x<C;x++){if(x in c&&f.call(m,c[x],x,c)===A)break}else for(x in c)if(o.call(c,x)&&f.call(m,c[x],x,c)===A)break};a.map=function(c,f,m){var x=[];if(c==null)return x;if(w&&c.map===w)return c.map(f,m);k(c,function(C,F,I){x[x.length]=f.call(m,C,F,I)});return x};a.reduce=a.foldl=a.inject=function(c,f,m,x){var C=m!==void 0;c==null&&(c=[]);if(e&&c.reduce===e)return x&&(f=a.bind(f,x)),C?c.reduce(f,m):c.reduce(f);k(c,function(F,I,M){C?m=f.call(x,m,F,I,M):(m=F,C=true)});if(!C)throw new TypeError("Reduce of empty array with no initial value");
return m};a.reduceRight=a.foldr=function(c,f,m,x){c==null&&(c=[]);if(n&&c.reduceRight===n)return x&&(f=a.bind(f,x)),m!==void 0?c.reduceRight(f,m):c.reduceRight(f);c=(a.isArray(c)?c.slice():a.toArray(c)).reverse();return a.reduce(c,f,m,x)};a.find=a.detect=function(c,f,m){var x;g(c,function(C,F,I){if(f.call(m,C,F,I))return x=C,true});return x};a.filter=a.select=function(c,f,m){var x=[];if(c==null)return x;if(t&&c.filter===t)return c.filter(f,m);k(c,function(C,F,I){f.call(m,C,F,I)&&(x[x.length]=C)});
return x};a.reject=function(c,f,m){var x=[];if(c==null)return x;k(c,function(C,F,I){f.call(m,C,F,I)||(x[x.length]=C)});return x};a.every=a.all=function(c,f,m){var x=true;if(c==null)return x;if(y&&c.every===y)return c.every(f,m);k(c,function(C,F,I){if(!(x=x&&f.call(m,C,F,I)))return A});return x};var g=a.some=a.any=function(c,f,m){f=f||a.identity;var x=false;if(c==null)return x;if(G&&c.some===G)return c.some(f,m);k(c,function(C,F,I){if(x|=f.call(m,C,F,I))return A});return!!x};a.include=a.contains=function(c,
f){var m=false;if(c==null)return m;if(d&&c.indexOf===d)return c.indexOf(f)!=-1;g(c,function(x){if(m=x===f)return true});return m};a.invoke=function(c,f){var m=z.call(arguments,2);return a.map(c,function(x){return(f.call?f||x:x[f]).apply(x,m)})};a.pluck=function(c,f){return a.map(c,function(m){return m[f]})};a.max=function(c,f,m){if(!f&&a.isArray(c))return Math.max.apply(Math,c);var x={computed:-Infinity};k(c,function(C,F,I){F=f?f.call(m,C,F,I):C;F>=x.computed&&(x={value:C,computed:F})});return x.value};
a.min=function(c,f,m){if(!f&&a.isArray(c))return Math.min.apply(Math,c);var x={computed:Infinity};k(c,function(C,F,I){F=f?f.call(m,C,F,I):C;F<x.computed&&(x={value:C,computed:F})});return x.value};a.sortBy=function(c,f,m){return a.pluck(a.map(c,function(x,C,F){return{value:x,criteria:f.call(m,x,C,F)}}).sort(function(x,C){var F=x.criteria,I=C.criteria;return F<I?-1:F>I?1:0}),"value")};a.groupBy=function(c,f){var m={};k(c,function(x,C){var F=f(x,C);(m[F]||(m[F]=[])).push(x)});return m};a.sortedIndex=
function(c,f,m){m||(m=a.identity);for(var x=0,C=c.length;x<C;){var F=x+C>>1;m(c[F])<m(f)?x=F+1:C=F}return x};a.toArray=function(c){if(!c)return[];if(c.toArray)return c.toArray();if(a.isArray(c))return z.call(c);if(a.isArguments(c))return z.call(c);return a.values(c)};a.size=function(c){return a.toArray(c).length};a.first=a.head=function(c,f,m){return f!=null&&!m?z.call(c,0,f):c[0]};a.rest=a.tail=function(c,f,m){return z.call(c,f==null||m?1:f)};a.last=function(c){return c[c.length-1]};a.compact=function(c){return a.filter(c,
function(f){return!!f})};a.flatten=function(c){return a.reduce(c,function(f,m){if(a.isArray(m))return f.concat(a.flatten(m));f[f.length]=m;return f},[])};a.without=function(c){return a.difference(c,z.call(arguments,1))};a.uniq=a.unique=function(c,f){return a.reduce(c,function(m,x,C){if(0==C||(f===true?a.last(m)!=x:!a.include(m,x)))m[m.length]=x;return m},[])};a.union=function(){return a.uniq(a.flatten(arguments))};a.intersection=a.intersect=function(c){var f=z.call(arguments,1);return a.filter(a.uniq(c),
function(m){return a.every(f,function(x){return a.indexOf(x,m)>=0})})};a.difference=function(c,f){return a.filter(c,function(m){return!a.include(f,m)})};a.zip=function(){for(var c=z.call(arguments),f=a.max(a.pluck(c,"length")),m=Array(f),x=0;x<f;x++)m[x]=a.pluck(c,""+x);return m};a.indexOf=function(c,f,m){if(c==null)return-1;var x;if(m)return m=a.sortedIndex(c,f),c[m]===f?m:-1;if(d&&c.indexOf===d)return c.indexOf(f);m=0;for(x=c.length;m<x;m++)if(c[m]===f)return m;return-1};a.lastIndexOf=function(c,
f){if(c==null)return-1;if(l&&c.lastIndexOf===l)return c.lastIndexOf(f);for(var m=c.length;m--;)if(c[m]===f)return m;return-1};a.range=function(c,f,m){arguments.length<=1&&(f=c||0,c=0);m=arguments[2]||1;for(var x=Math.max(Math.ceil((f-c)/m),0),C=0,F=Array(x);C<x;){F[C++]=c;c+=m}return F};a.bind=function(c,f){if(c.bind===b&&b)return b.apply(c,z.call(arguments,1));var m=z.call(arguments,2);return function(){return c.apply(f,m.concat(z.call(arguments)))}};a.bindAll=function(c){var f=z.call(arguments,
1);f.length==0&&(f=a.functions(c));k(f,function(m){c[m]=a.bind(c[m],c)});return c};a.memoize=function(c,f){var m={};f||(f=a.identity);return function(){var x=f.apply(this,arguments);return o.call(m,x)?m[x]:m[x]=c.apply(this,arguments)}};a.delay=function(c,f){var m=z.call(arguments,2);return setTimeout(function(){return c.apply(c,m)},f)};a.defer=function(c){return a.delay.apply(a,[c,1].concat(z.call(arguments,1)))};var i=function(c,f,m){var x;return function(){var C=this,F=arguments,I=function(){x=
null;c.apply(C,F)};m&&clearTimeout(x);if(m||!x)x=setTimeout(I,f)}};a.throttle=function(c,f){return i(c,f,false)};a.debounce=function(c,f){return i(c,f,true)};a.once=function(c){var f=false,m;return function(){if(f)return m;f=true;return m=c.apply(this,arguments)}};a.wrap=function(c,f){return function(){var m=[c].concat(z.call(arguments));return f.apply(this,m)}};a.compose=function(){var c=z.call(arguments);return function(){for(var f=z.call(arguments),m=c.length-1;m>=0;m--)f=[c[m].apply(this,f)];
return f[0]}};a.after=function(c,f){return function(){if(--c<1)return f.apply(this,arguments)}};a.keys=p||function(c){if(c!==Object(c))throw new TypeError("Invalid object");var f=[],m;for(m in c)o.call(c,m)&&(f[f.length]=m);return f};a.values=function(c){return a.map(c,a.identity)};a.functions=a.methods=function(c){var f=[],m;for(m in c)a.isFunction(c[m])&&f.push(m);return f.sort()};a.extend=function(c){k(z.call(arguments,1),function(f){for(var m in f)f[m]!==void 0&&(c[m]=f[m])});return c};a.defaults=
function(c){k(z.call(arguments,1),function(f){for(var m in f)c[m]==null&&(c[m]=f[m])});return c};a.clone=function(c){return a.isArray(c)?c.slice():a.extend({},c)};a.tap=function(c,f){f(c);return c};a.isEqual=function(c,f){if(c===f)return true;var m=typeof c;if(m!=typeof f)return false;if(c==f)return true;if(!c&&f||c&&!f)return false;if(c._chain)c=c._wrapped;if(f._chain)f=f._wrapped;if(c.isEqual)return c.isEqual(f);if(f.isEqual)return f.isEqual(c);if(a.isDate(c)&&a.isDate(f))return c.getTime()===f.getTime();
if(a.isNaN(c)&&a.isNaN(f))return false;if(a.isRegExp(c)&&a.isRegExp(f))return c.source===f.source&&c.global===f.global&&c.ignoreCase===f.ignoreCase&&c.multiline===f.multiline;if(m!=="object")return false;if(c.length&&c.length!==f.length)return false;m=a.keys(c);var x=a.keys(f);if(m.length!=x.length)return false;for(var C in c)if(!(C in f)||!a.isEqual(c[C],f[C]))return false;return true};a.isEmpty=function(c){if(a.isArray(c)||a.isString(c))return c.length===0;for(var f in c)if(o.call(c,f))return false;
return true};a.isElement=function(c){return!!(c&&c.nodeType==1)};a.isArray=E||function(c){return v.call(c)==="[object Array]"};a.isObject=function(c){return c===Object(c)};a.isArguments=function(c){return!(!c||!o.call(c,"callee"))};a.isFunction=function(c){return!(!c||!c.constructor||!c.call||!c.apply)};a.isString=function(c){return!!(c===""||c&&c.charCodeAt&&c.substr)};a.isNumber=function(c){return!!(c===0||c&&c.toExponential&&c.toFixed)};a.isNaN=function(c){return c!==c};a.isBoolean=function(c){return c===
true||c===false};a.isDate=function(c){return!(!c||!c.getTimezoneOffset||!c.setUTCFullYear)};a.isRegExp=function(c){return!(!c||!c.test||!c.exec||!(c.ignoreCase||c.ignoreCase===false))};a.isNull=function(c){return c===null};a.isUndefined=function(c){return c===void 0};a.noConflict=function(){s._=D;return this};a.identity=function(c){return c};a.times=function(c,f,m){for(var x=0;x<c;x++)f.call(m,x)};a.mixin=function(c){k(a.functions(c),function(f){B(f,a[f]=c[f])})};var h=0;a.uniqueId=function(c){var f=
h++;return c?c+f:f};a.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g};a.template=function(c,f){var m=a.templateSettings;m="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+c.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(m.interpolate,function(x,C){return"',"+C.replace(/\\'/g,"'")+",'"}).replace(m.evaluate||null,function(x,C){return"');"+C.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,
"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');";m=new Function("obj",m);return f?m(f):m};var r=function(c){this._wrapped=c};a.prototype=r.prototype;var u=function(c,f){return f?a(c).chain():c},B=function(c,f){r.prototype[c]=function(){var m=z.call(arguments);H.call(m,this._wrapped);return u(f.apply(a,m),this._chain)}};a.mixin(a);k(["pop","push","reverse","shift","sort","splice","unshift"],function(c){var f=q[c];r.prototype[c]=function(){f.apply(this._wrapped,arguments);return u(this._wrapped,
this._chain)}});k(["concat","join","slice"],function(c){var f=q[c];r.prototype[c]=function(){return u(f.apply(this._wrapped,arguments),this._chain)}});r.prototype.chain=function(){this._chain=true;return this};r.prototype.value=function(){return this._wrapped}})();/*

 // Backbone.js 0.5.3
 // (c) 2010 Jeremy Ashkenas, DocumentCloud Inc.
 // Backbone may be freely distributed under the MIT license.
 // For all details and documentation:
 // http://documentcloud.github.com/backbone
*/
(function(){var s=this,D=s.Backbone,A;A=typeof exports!=="undefined"?exports:s.Backbone={};A.VERSION="0.5.3";var q=s._;if(!q&&typeof require!=="undefined")q=require("underscore")._;var E=s.jQuery||s.Zepto;A.noConflict=function(){s.Backbone=D;return this};A.emulateHTTP=false;A.emulateJSON=false;A.Events={bind:function(b,a,k){var g=this._callbacks||(this._callbacks={});(g[b]||(g[b]=[])).push([a,k]);return this},unbind:function(b,a){var k;if(b){if(k=this._callbacks)if(a){k=k[b];if(!k)return this;for(var g=
0,i=k.length;g<i;g++)if(k[g]&&a===k[g][0]){k[g]=null;break}}else k[b]=[]}else this._callbacks={};return this},trigger:function(b){var a,k,g,i,h=2;if(!(k=this._callbacks))return this;for(;h--;)if(a=h?b:"all",a=k[a])for(var r=0,u=a.length;r<u;r++)(g=a[r])?(i=h?Array.prototype.slice.call(arguments,1):arguments,g[0].apply(g[1]||this,i)):(a.splice(r,1),r--,u--);return this}};A.Model=function(b,a){var k;b||(b={});if(k=this.defaults){q.isFunction(k)&&(k=k.call(this));b=q.extend({},k,b)}this.attributes={};
this._escapedAttributes={};this.cid=q.uniqueId("c");this.set(b,{silent:true});this._changed=false;this._previousAttributes=q.clone(this.attributes);if(a&&a.collection)this.collection=a.collection;this.initialize(b,a)};q.extend(A.Model.prototype,A.Events,{_previousAttributes:null,_changed:false,idAttribute:"id",initialize:function(){},toJSON:function(){return q.clone(this.attributes)},get:function(b){return this.attributes[b]},escape:function(b){var a;if(a=this._escapedAttributes[b])return a;a=this.attributes[b];
return this._escapedAttributes[b]=(a==null?"":""+a).replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},has:function(b){return this.attributes[b]!=null},set:function(b,a){a||(a={});if(!b)return this;if(b.attributes)b=b.attributes;var k=this.attributes,g=this._escapedAttributes;if(!a.silent&&this.validate&&!this._performValidation(b,a))return false;if(this.idAttribute in b)this.id=b[this.idAttribute];
var i=this._changing;this._changing=true;for(var h in b){var r=b[h];if(!q.isEqual(k[h],r)){k[h]=r;delete g[h];this._changed=true;a.silent||this.trigger("change:"+h,this,r,a)}}!i&&!a.silent&&this._changed&&this.change(a);this._changing=false;return this},unset:function(b,a){if(!(b in this.attributes))return this;a||(a={});var k={};k[b]=void 0;if(!a.silent&&this.validate&&!this._performValidation(k,a))return false;delete this.attributes[b];delete this._escapedAttributes[b];b==this.idAttribute&&delete this.id;
this._changed=true;a.silent||(this.trigger("change:"+b,this,void 0,a),this.change(a));return this},clear:function(b){b||(b={});var a,k=this.attributes,g={};for(a in k)g[a]=void 0;if(!b.silent&&this.validate&&!this._performValidation(g,b))return false;this.attributes={};this._escapedAttributes={};this._changed=true;if(!b.silent){for(a in k)this.trigger("change:"+a,this,void 0,b);this.change(b)}return this},fetch:function(b){b||(b={});var a=this,k=b.success;b.success=function(g,i,h){if(!a.set(a.parse(g,
h),b))return false;k&&k(a,g)};b.error=p(b.error,a,b);return(this.sync||A.sync).call(this,"read",this,b)},save:function(b,a){a||(a={});if(b&&!this.set(b,a))return false;var k=this,g=a.success;a.success=function(h,r,u){if(!k.set(k.parse(h,u),a))return false;g&&g(k,h,u)};a.error=p(a.error,k,a);var i=this.isNew()?"create":"update";return(this.sync||A.sync).call(this,i,this,a)},destroy:function(b){b||(b={});if(this.isNew())return this.trigger("destroy",this,this.collection,b);var a=this,k=b.success;b.success=
function(g){a.trigger("destroy",a,a.collection,b);k&&k(a,g)};b.error=p(b.error,a,b);return(this.sync||A.sync).call(this,"delete",this,b)},url:function(){var b=d(this.collection)||this.urlRoot||l();if(this.isNew())return b;return b+(b.charAt(b.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(b){return b},clone:function(){return new this.constructor(this)},isNew:function(){return this.id==null},change:function(b){this.trigger("change",this,b);this._previousAttributes=q.clone(this.attributes);
this._changed=false},hasChanged:function(b){if(b)return this._previousAttributes[b]!=this.attributes[b];return this._changed},changedAttributes:function(b){b||(b=this.attributes);var a=this._previousAttributes,k=false,g;for(g in b)q.isEqual(a[g],b[g])||(k=k||{},k[g]=b[g]);return k},previous:function(b){if(!b||!this._previousAttributes)return null;return this._previousAttributes[b]},previousAttributes:function(){return q.clone(this._previousAttributes)},_performValidation:function(b,a){var k=this.validate(b);
if(k)return a.error?a.error(this,k,a):this.trigger("error",this,k,a),false;return true}});A.Collection=function(b,a){a||(a={});if(a.comparator)this.comparator=a.comparator;q.bindAll(this,"_onModelEvent","_removeReference");this._reset();b&&this.reset(b,{silent:true});this.initialize.apply(this,arguments)};q.extend(A.Collection.prototype,A.Events,{model:A.Model,initialize:function(){},toJSON:function(){return this.map(function(b){return b.toJSON()})},add:function(b,a){if(q.isArray(b))for(var k=0,g=
b.length;k<g;k++)this._add(b[k],a);else this._add(b,a);return this},remove:function(b,a){if(q.isArray(b))for(var k=0,g=b.length;k<g;k++)this._remove(b[k],a);else this._remove(b,a);return this},get:function(b){if(b==null)return null;return this._byId[b.id!=null?b.id:b]},getByCid:function(b){return b&&this._byCid[b.cid||b]},at:function(b){return this.models[b]},sort:function(b){b||(b={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");this.models=this.sortBy(this.comparator);
b.silent||this.trigger("reset",this,b);return this},pluck:function(b){return q.map(this.models,function(a){return a.get(b)})},reset:function(b,a){b||(b=[]);a||(a={});this.each(this._removeReference);this._reset();this.add(b,{silent:true});a.silent||this.trigger("reset",this,a);return this},fetch:function(b){b||(b={});var a=this,k=b.success;b.success=function(g,i,h){a[b.add?"add":"reset"](a.parse(g,h),b);k&&k(a,g)};b.error=p(b.error,a,b);return(this.sync||A.sync).call(this,"read",this,b)},create:function(b,
a){var k=this;a||(a={});b=this._prepareModel(b,a);if(!b)return false;var g=a.success;a.success=function(i,h,r){k.add(i,a);g&&g(i,h,r)};b.save(null,a);return b},parse:function(b){return b},chain:function(){return q(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(b,a){if(b instanceof A.Model){if(!b.collection)b.collection=this}else{var k=b;b=new this.model(k,{collection:this});b.validate&&!b._performValidation(k,a)&&(b=false)}return b},
_add:function(b,a){a||(a={});b=this._prepareModel(b,a);if(!b)return false;var k=this.getByCid(b);if(k)throw Error(["Can't add the same model to a set twice",k.id]);this._byId[b.id]=b;this._byCid[b.cid]=b;this.models.splice(a.at!=null?a.at:this.comparator?this.sortedIndex(b,this.comparator):this.length,0,b);b.bind("all",this._onModelEvent);this.length++;a.silent||b.trigger("add",b,this,a);return b},_remove:function(b,a){a||(a={});b=this.getByCid(b)||this.get(b);if(!b)return null;delete this._byId[b.id];
delete this._byCid[b.cid];this.models.splice(this.indexOf(b),1);this.length--;a.silent||b.trigger("remove",b,this,a);this._removeReference(b);return b},_removeReference:function(b){this==b.collection&&delete b.collection;b.unbind("all",this._onModelEvent)},_onModelEvent:function(b,a,k,g){(b=="add"||b=="remove")&&k!=this||(b=="destroy"&&this._remove(a,g),a&&b==="change:"+a.idAttribute&&(delete this._byId[a.previous(a.idAttribute)],this._byId[a.id]=a),this.trigger.apply(this,arguments))}});q.each(["forEach",
"each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty","groupBy"],function(b){A.Collection.prototype[b]=function(){return q[b].apply(q,[this.models].concat(q.toArray(arguments)))}});A.Router=function(b){b||(b={});if(b.routes)this.routes=b.routes;this._bindRoutes();this.initialize.apply(this,arguments)};
var z=/:([\w\d]+)/g,H=/\*([\w\d]+)/g,v=/[-[\]{}()+?.,\\^$|#\s]/g;q.extend(A.Router.prototype,A.Events,{initialize:function(){},route:function(b,a,k){A.history||(A.history=new A.History);q.isRegExp(b)||(b=this._routeToRegExp(b));A.history.route(b,q.bind(function(g){g=this._extractParameters(b,g);k.apply(this,g);this.trigger.apply(this,["route:"+a].concat(g))},this))},navigate:function(b,a){A.history.navigate(b,a)},_bindRoutes:function(){if(this.routes){var b=[],a;for(a in this.routes)b.unshift([a,
this.routes[a]]);a=0;for(var k=b.length;a<k;a++)this.route(b[a][0],b[a][1],this[b[a][1]])}},_routeToRegExp:function(b){b=b.replace(v,"\\$&").replace(z,"([^/]*)").replace(H,"(.*?)");return RegExp("^"+b+"$")},_extractParameters:function(b,a){return b.exec(a).slice(1)}});A.History=function(){this.handlers=[];q.bindAll(this,"checkUrl")};var o=/^#*/,j=/msie [\w.]+/,w=false;q.extend(A.History.prototype,{interval:50,getFragment:function(b,a){if(b==null)if(this._hasPushState||a){b=window.location.pathname;
var k=window.location.search;k&&(b+=k);b.indexOf(this.options.root)==0&&(b=b.substr(this.options.root.length))}else b=window.location.hash;return decodeURIComponent(b.replace(o,""))},start:function(b){if(w)throw Error("Backbone.history has already been started");this.options=q.extend({},{root:"/"},this.options,b);this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);b=this.getFragment();var a=document.documentMode;if(a=
j.exec(navigator.userAgent.toLowerCase())&&(!a||a<=7)){this.iframe=E('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(b)}this._hasPushState?E(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!a?E(window).bind("hashchange",this.checkUrl):setInterval(this.checkUrl,this.interval);this.fragment=b;w=true;b=window.location;a=b.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!a)return this.fragment=this.getFragment(null,
true),window.location.replace(this.options.root+"#"+this.fragment),true;else if(this._wantsPushState&&this._hasPushState&&a&&b.hash){this.fragment=b.hash.replace(o,"");window.history.replaceState({},document.title,b.protocol+"//"+b.host+this.options.root+this.fragment)}if(!this.options.silent)return this.loadUrl()},route:function(b,a){this.handlers.unshift({route:b,callback:a})},checkUrl:function(){var b=this.getFragment();b==this.fragment&&this.iframe&&(b=this.getFragment(this.iframe.location.hash));
if(b==this.fragment||b==decodeURIComponent(this.fragment))return false;this.iframe&&this.navigate(b);this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(b){var a=this.fragment=this.getFragment(b);return q.any(this.handlers,function(k){if(k.route.test(a))return k.callback(a),true})},navigate:function(b,a){var k=(b||"").replace(o,"");if(!(this.fragment==k||this.fragment==decodeURIComponent(k))){if(this._hasPushState){var g=window.location;k.indexOf(this.options.root)!=0&&(k=this.options.root+
k);this.fragment=k;window.history.pushState({},document.title,g.protocol+"//"+g.host+k)}else if(window.location.hash=this.fragment=k,this.iframe&&k!=this.getFragment(this.iframe.location.hash)){this.iframe.document.open().close();this.iframe.location.hash=k}a&&this.loadUrl(b)}}});A.View=function(b){this.cid=q.uniqueId("view");this._configure(b||{});this._ensureElement();this.delegateEvents();this.initialize.apply(this,arguments)};var e=/^(\S+)\s*(.*)$/,n=["model","collection","el","id","attributes",
"className","tagName"];q.extend(A.View.prototype,A.Events,{tagName:"div",$:function(b){return E(b,this.el)},initialize:function(){},render:function(){return this},remove:function(){E(this.el).remove();return this},make:function(b,a,k){b=document.createElement(b);a&&E(b).attr(a);k&&E(b).html(k);return b},delegateEvents:function(b){if(b||(b=this.events))for(var a in q.isFunction(b)&&(b=b.call(this)),E(this.el).unbind(".delegateEvents"+this.cid),b){var k=this[b[a]];if(!k)throw Error('Event "'+b[a]+'" does not exist');
var g=a.match(e),i=g[1];g=g[2];k=q.bind(k,this);i+=".delegateEvents"+this.cid;g===""?E(this.el).bind(i,k):E(this.el).delegate(g,i,k)}},_configure:function(b){this.options&&(b=q.extend({},this.options,b));for(var a=0,k=n.length;a<k;a++){var g=n[a];b[g]&&(this[g]=b[g])}this.options=b},_ensureElement:function(){if(this.el){if(q.isString(this.el))this.el=E(this.el).get(0)}else{var b=this.attributes||{};if(this.id)b.id=this.id;if(this.className)b["class"]=this.className;this.el=this.make(this.tagName,
b)}}});A.Model.extend=A.Collection.extend=A.Router.extend=A.View.extend=function(b,a){var k=G(this,b,a);k.extend=this.extend;return k};var t={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};A.sync=function(b,a,k){var g=t[b];k=q.extend({type:g,dataType:"json"},k);if(!k.url)k.url=d(a)||l();if(!k.data&&a&&(b=="create"||b=="update")){k.contentType="application/json";k.data=JSON.stringify(a.toJSON())}if(A.emulateJSON){k.contentType="application/x-www-form-urlencoded";k.data=k.data?{model:k.data}:
{}}if(A.emulateHTTP&&(g==="PUT"||g==="DELETE")){if(A.emulateJSON)k.data._method=g;k.type="POST";k.beforeSend=function(i){i.setRequestHeader("X-HTTP-Method-Override",g)}}if(k.type!=="GET"&&!A.emulateJSON)k.processData=false;return E.ajax(k)};var y=function(){},G=function(b,a,k){var g;g=a&&a.hasOwnProperty("constructor")?a.constructor:function(){return b.apply(this,arguments)};q.extend(g,b);y.prototype=b.prototype;g.prototype=new y;a&&q.extend(g.prototype,a);k&&q.extend(g,k);g.prototype.constructor=
g;g.__super__=b.prototype;return g},d=function(b){if(!b||!b.url)return null;return q.isFunction(b.url)?b.url():b.url},l=function(){throw Error('A "url" property or function must be specified');},p=function(b,a,k){return function(g){b?b(a,g,k):a.trigger("error",a,g,k)}}}).call(this);/*

 jQuery Templates Plugin 1.0.0pre
 http://github.com/jquery/jquery-tmpl
 Requires jQuery 1.4.2

 Copyright Software Freedom Conservancy, Inc.
 Dual licensed under the MIT or GPL Version 2 licenses.
 http://jquery.org/license
*/
(function(s){function D(i,h,r,u){u={data:u||u===0||u===false?u:h?h.data:{},_wrap:h?h._wrap:null,tmpl:null,parent:h||null,nodes:[],calls:o,nest:j,wrap:w,html:e,update:n};i&&s.extend(u,i,{nodes:[],parent:h});if(r){u.tmpl=r;u._ctnt=u._ctnt||u.tmpl(s,u);u.key=++a;(g.length?l:d)[a]=u}return u}function A(i,h,r){var u;r=r?s.map(r,function(B){return typeof B==="string"?i.key?B.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+y+'="'+i.key+'" $2'):B:A(B,i,B._ctnt)}):i;if(h)return r;r=r.join("");r.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(B,c,f,m){u=s(f).get();v(u);if(c)u=q(c).concat(u);if(m)u=u.concat(q(m))});return u?u:q(r)}function q(i){var h=document.createElement("div");h.innerHTML=i;return s.makeArray(h.childNodes)}function E(i){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+s.trim(i).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(h,r,u,B,c,f,m){h=s.tmpl.tag[u];if(!h)throw"Unknown template tag: "+u;u=h._default||[];if(f&&!/\w$/.test(c)){c+=f;f=""}if(c){c=H(c);m=m?","+H(m)+")":f?")":"";m=f?c.indexOf(".")>-1?c+H(f):"("+c+").call($item"+m:c;f=f?m:"(typeof("+c+")==='function'?("+c+").call($item):("+c+"))"}else f=m=u.$1||"null";B=H(B);return"');"+h[r?"close":"open"].split("$notnull_1").join(c?"typeof("+c+")!=='undefined' && ("+c+")!=null":"true").split("$1a").join(f).split("$1").join(m).split("$2").join(B||u.$2||"")+"__.push('"})+
"');}return __;")}function z(i,h){i._wrap=A(i,true,s.isArray(h)?h:[G.test(h)?h:s(h).html()]).join("")}function H(i){return i?i.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function v(i){function h(C){function F(N){N+=r;J=c[N]=c[N]||D(J,d[J.parent.key+r]||J.parent)}var I,M=C,J,O;if(O=C.getAttribute(y)){for(;M.parentNode&&(M=M.parentNode).nodeType===1&&!(I=M.getAttribute(y)););if(I!==O){M=M.parentNode?M.nodeType===11?0:M.getAttribute(y)||0:0;if(!(J=d[O])){J=l[O];J=D(J,d[M]||l[M]);J.key=++a;d[a]=J}k&&
F(O)}C.removeAttribute(y)}else if(k&&(J=s.data(C,"tmplItem"))){F(J.key);d[J.key]=J;M=(M=s.data(C.parentNode,"tmplItem"))?M.key:0}if(J){for(I=J;I&&I.key!=M;){I.nodes.push(C);I=I.parent}delete J._ctnt;delete J._wrap;s.data(C,"tmplItem",J)}}var r="_"+k,u,B,c={},f,m,x;f=0;for(m=i.length;f<m;f++)if((u=i[f]).nodeType===1){B=u.getElementsByTagName("*");for(x=B.length-1;x>=0;x--)h(B[x]);h(u)}}function o(i,h,r,u){if(!i)return g.pop();g.push({_:i,tmpl:h,item:this,data:r,options:u})}function j(i,h,r){return s.tmpl(s.template(i),
h,r,this)}function w(i,h){var r=i.options||{};r.wrapped=h;return s.tmpl(s.template(i.tmpl),i.data,r,i.item)}function e(i,h){var r=this._wrap;return s.map(s(s.isArray(r)?r.join(""):r).filter(i||"*"),function(u){if(h)u=u.innerText||u.textContent;else{var B;if(!(B=u.outerHTML)){B=document.createElement("div");B.appendChild(u.cloneNode(true));B=B.innerHTML}u=B}return u})}function n(){var i=this.nodes;s.tmpl(null,null,null,this).insertBefore(i[0]);s(i).remove()}var t=s.fn.domManip,y="_tmplitem",G=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,
d={},l={},p,b={key:0,data:{}},a=0,k=0,g=[];s.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(i,h){s.fn[i]=function(r){var u=[];r=s(r);var B,c,f;B=this.length===1&&this[0].parentNode;p=d||{};if(B&&B.nodeType===11&&B.childNodes.length===1&&r.length===1){r[h](this[0]);u=this}else{c=0;for(f=r.length;c<f;c++){k=c;B=(c>0?this.clone(true):this).get();s(r[c])[h](B);u=u.concat(B)}k=0;u=this.pushStack(u,i,r.selector)}r=p;p=null;s.tmpl.complete(r);
return u}});s.fn.extend({tmpl:function(i,h,r){return s.tmpl(this[0],i,h,r)},tmplItem:function(){return s.tmplItem(this[0])},template:function(i){return s.template(i,this[0])},domManip:function(i,h,r){if(i[0]&&s.isArray(i[0])){for(var u=s.makeArray(arguments),B=i[0],c=B.length,f=0,m;f<c&&!(m=s.data(B[f++],"tmplItem")););if(m&&k)u[2]=function(x){s.tmpl.afterManip(this,x,r)};t.apply(this,u)}else t.apply(this,arguments);k=0;p||s.tmpl.complete(d);return this}});s.extend({tmpl:function(i,h,r,u){var B=!u;
if(B){u=b;i=s.template[i]||s.template(null,i);l={}}else if(!i){i=u.tmpl;d[u.key]=u;u.nodes=[];u.wrapped&&z(u,u.wrapped);return s(A(u,null,u.tmpl(s,u)))}if(!i)return[];if(typeof h==="function")h=h.call(u||{});r&&r.wrapped&&z(r,r.wrapped);h=s.isArray(h)?s.map(h,function(c){return c?D(r,u,i,c):null}):[D(r,u,i,h)];return B?s(A(u,null,h)):h},tmplItem:function(i){var h;if(i instanceof s)i=i[0];for(;i&&i.nodeType===1&&!(h=s.data(i,"tmplItem"))&&(i=i.parentNode););return h||b},template:function(i,h){if(h){if(typeof h===
"string")h=E(h);else if(h instanceof s)h=h[0]||{};if(h.nodeType)h=s.data(h,"tmpl")||s.data(h,"tmpl",E(h.innerHTML));return typeof i==="string"?s.template[i]=h:h}return i?typeof i!=="string"?s.template(null,i):s.template[i]||s.template(null,G.test(i)?i:s(i)):null},encode:function(i){return(""+i).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});s.extend(s.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},
wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){d=
{}},afterManip:function(i,h,r){var u=h.nodeType===11?s.makeArray(h.childNodes):h.nodeType===1?[h]:[];r.call(i,h);v(u);k++}})})(jQuery);/*
 
 JavaScript Debug - v0.4 - 6/22/2010
 http://benalman.com/projects/javascript-debug-console-log/

 Copyright (c) 2010 "Cowboy" Ben Alman
 Dual licensed under the MIT and GPL licenses.
 http://benalman.com/about/license/

 With lots of help from Paul Irish!
 http://paulirish.com/
*/
window.debug=function(){function s(n){if(z&&(H||!q||!q.log))z.apply(D,n)}for(var D=this,A=Array.prototype.slice,q=D.console,E={},z,H,v=9,o=["error","warn","info","debug","log"],j="assert clear count dir dirxml exception group groupCollapsed groupEnd profile profileEnd table time timeEnd trace".split(" "),w=j.length,e=[];--w>=0;)(function(n){E[n]=function(){v!==0&&q&&q[n]&&q[n].apply(q,arguments)}})(j[w]);for(w=o.length;--w>=0;)(function(n,t){E[t]=function(){var y=A.call(arguments),G=[t].concat(y);
e.push(G);s(G);if(q&&(v>0?v>n:o.length+v<=n))q.firebug?q[t].apply(D,y):q[t]?q[t](y):q.log(y)}})(w,o[w]);E.setLevel=function(n){v=typeof n==="number"?n:9};E.setCallback=function(){var n=A.call(arguments),t=e.length,y=t;z=n.shift()||null;H=typeof n[0]==="boolean"?n.shift():false;for(y-=typeof n[0]==="number"?n.shift():t;y<t;)s(e[y++])};return E}();(function(s){var D=s("<b/>");s.subscribe=function(A,q){function E(){return q.apply(this,Array.prototype.slice.call(arguments,1))}E.guid=q.guid=q.guid||(s.guid?s.guid++:s.event.guid++);D.bind(A,E)};s.unsubscribe=function(){D.unbind.apply(D,arguments)};s.publish=function(){D.trigger.apply(D,arguments)}})(jQuery);/*

 Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 Licensed under the MIT License (LICENSE.txt).

 Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 Thanks to: Seamus Leahy for adding deltaX and deltaY

 Version: 3.0.6

 Requires: 1.2.2+
*/
(function(s){function D(E){var z=E||window.event,H=[].slice.call(arguments,1),v=0,o=0,j=0;return E=s.event.fix(z),E.type="mousewheel",z.detail&&(v=-z.detail/3),z.wheelDeltaY!==undefined&&(j=z.wheelDeltaY/120),z.wheelDeltaX!==undefined&&(o=-1*z.wheelDeltaX/120),H.unshift(E,v,o,j),(s.event.dispatch||s.event.handle).apply(this,H)}var A=["DOMMouseScroll","mousewheel"];if(s.event.fixHooks)for(var q=A.length;q;)s.event.fixHooks[A[--q]]=s.event.mouseHooks;s.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var E=
A.length;E;)this.addEventListener(A[--E],D,false);else this.onmousewheel=D},teardown:function(){if(this.removeEventListener)for(var E=A.length;E;)this.removeEventListener(A[--E],D,false);else this.onmousewheel=null}};s.fn.extend({mousewheel:function(E){return E?this.bind("mousewheel",E):this.trigger("mousewheel")},unmousewheel:function(E){return this.unbind("mousewheel",E)}})})(jQuery);/*

 jQuery.UI.iPad plugin
 Copyright (c) 2010 Stephen von Takach
 licensed under MIT.
 Date: 27/8/2010

 Project Home: 
 http://code.google.com/p/jquery-ui-for-ipad-and-iphone/
*/
$(function(){$.extend($.support,{touch:"ontouchend"in document});$.fn.addTouch=function(){$.support.touch&&this.each(function(s,D){D.addEventListener("touchstart",iPadTouchHandler,false);D.addEventListener("touchmove",iPadTouchHandler,false);D.addEventListener("touchend",iPadTouchHandler,false);D.addEventListener("touchcancel",iPadTouchHandler,false)})}});var lastTap=null,tapValid=false,tapTimeout=null;function cancelTap(){tapValid=false}
var rightClickPending=false,rightClickEvent=null,holdTimeout=null,cancelMouseUp=false;function cancelHold(){if(rightClickPending){window.clearTimeout(holdTimeout);rightClickPending=false;rightClickEvent=null}}function startHold(s){if(!rightClickPending){rightClickPending=true;rightClickEvent=s.changedTouches[0];holdTimeout=window.setTimeout("doRightClick();",800)}}
function doRightClick(){rightClickPending=false;var s=rightClickEvent,D=document.createEvent("MouseEvent");D.initMouseEvent("mouseup",true,true,window,1,s.screenX,s.screenY,s.clientX,s.clientY,false,false,false,false,0,null);s.target.dispatchEvent(D);D=document.createEvent("MouseEvent");D.initMouseEvent("mousedown",true,true,window,1,s.screenX,s.screenY,s.clientX,s.clientY,false,false,false,false,2,null);s.target.dispatchEvent(D);D=document.createEvent("MouseEvent");D.initMouseEvent("contextmenu",
true,true,window,1,s.screenX+50,s.screenY+5,s.clientX+50,s.clientY+5,false,false,false,false,2,null);s.target.dispatchEvent(D);cancelMouseUp=true;rightClickEvent=null}
function iPadTouchStart(s){var D=s.changedTouches[0],A="mouseover",q=document.createEvent("MouseEvent");q.initMouseEvent(A,true,true,window,1,D.screenX,D.screenY,D.clientX,D.clientY,false,false,false,false,0,null);D.target.dispatchEvent(q);A="mousedown";q=document.createEvent("MouseEvent");q.initMouseEvent(A,true,true,window,1,D.screenX,D.screenY,D.clientX,D.clientY,false,false,false,false,0,null);D.target.dispatchEvent(q);if(tapValid){window.clearTimeout(tapTimeout);if(D.target==lastTap){lastTap=
null;tapValid=false;A="click";q=document.createEvent("MouseEvent");q.initMouseEvent(A,true,true,window,1,D.screenX,D.screenY,D.clientX,D.clientY,false,false,false,false,0,null);D.target.dispatchEvent(q);A="dblclick";q=document.createEvent("MouseEvent");q.initMouseEvent(A,true,true,window,1,D.screenX,D.screenY,D.clientX,D.clientY,false,false,false,false,0,null);D.target.dispatchEvent(q)}else{lastTap=D.target;tapValid=true;tapTimeout=window.setTimeout("cancelTap();",600);startHold(s)}}else{lastTap=
D.target;tapValid=true;tapTimeout=window.setTimeout("cancelTap();",600);startHold(s)}}
function iPadTouchHandler(s){var D="";if(!(s.touches.length>1)){switch(s.type){case "touchstart":if($(s.changedTouches[0].target).is("select"))return;iPadTouchStart(s);s.preventDefault();return false;case "touchmove":cancelHold();D="mousemove";s.preventDefault();break;case "touchend":if(cancelMouseUp){cancelMouseUp=false;s.preventDefault();return false}cancelHold();D="mouseup";break;default:return}s=s.changedTouches[0];var A=document.createEvent("MouseEvent");A.initMouseEvent(D,true,true,window,1,
s.screenX,s.screenY,s.clientX,s.clientY,false,false,false,false,0,null);s.target.dispatchEvent(A);if(D=="mouseup"&&tapValid&&s.target==lastTap){A=document.createEvent("MouseEvent");A.initMouseEvent("click",true,true,window,1,s.screenX,s.screenY,s.clientX,s.clientY,false,false,false,false,0,null);s.target.dispatchEvent(A)}}};(function(){function s(g){return(g+"").replace(l,"")}function D(g,i,h){for(var r=g.length;r<i;r++)g=h?"0"+g:g+"0";return g}function A(g){return k.call(g)==="[object Array]"}function q(g,i){if(g.indexOf)return g.indexOf(i);for(var h=0,r=g.length;h<r;h++)if(g[h]===i)return h;return-1}function E(g,i,h){var r=i["-"];i=i["+"];var u;switch(h){case "n -":r=" "+r;i=" "+i;case "n-":if(g.substr(g.length-r.length)===r)u=["-",g.substr(0,g.length-r.length)];else if(g.substr(g.length-i.length)===i)u=["+",g.substr(0,
g.length-i.length)];break;case "- n":r+=" ";i+=" ";case "-n":if(g.indexOf(r)===0)u=["-",g.substr(r.length)];else if(g.indexOf(i)===0)u=["+",g.substr(i.length)];break;case "(n)":if(g.indexOf("(")===0&&g.substr(g.length-1)===")")u=["-",g.substr(1,g.length-2)]}return u||["",g]}function z(g,i){if(!i)return 0;for(var h,r=g.getTime(),u=0,B=i.length;u<B;u++){h=i[u].start;if(h===null||r>=h)return u}return 0}function H(g){return g.split("\u00a0").join(" ").toUpperCase()}function v(g){for(var i=[],h=0,r=g.length;h<
r;h++)i[h]=H(g[h]);return i}function o(g,i,h,r){g=g.getFullYear();if(!r&&i.eras)g-=i.eras[h].offset;return g}function j(g,i){for(var h=0,r=false,u=0,B=g.length;u<B;u++){var c=g.charAt(u);switch(c){case "'":if(r)i.push("'");else h++;r=false;break;case "\\":r&&i.push("\\");r=!r;break;default:i.push(c);r=false}}return h}function w(g,i){i=i||"F";var h;h=g.patterns;var r=i.length;if(r===1){h=h[i];if(!h)throw"Invalid date format string '"+i+"'.";i=h}else if(r===2&&i.charAt(0)==="%")i=i.charAt(1);return i}
function e(){return/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|gg|g/g}function n(g,i,h){g=s(g);h=h.calendar;a:{var r=h._parseRegExp;if(r){var u=r[i];if(u){i=u;break a}}else h._parseRegExp=r={};u=w(h,i).replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1");for(var B=["^"],c=[],f=0,m=0,x=e(),C;(C=x.exec(u))!==null;){var F=u.slice(f,C.index);f=x.lastIndex;m+=j(F,B);if(m%2)B.push(C[0]);else{F=C[0];var I=F.length;switch(F){case "dddd":case "ddd":case "MMMM":case "MMM":case "gg":case "g":F=
"(\\D+)";break;case "tt":case "t":F="(\\D*)";break;case "yyyy":case "fff":case "ff":case "f":F="(\\d{"+I+"})";break;case "dd":case "d":case "MM":case "M":case "yy":case "y":case "HH":case "H":case "hh":case "h":case "mm":case "m":case "ss":case "s":F="(\\d\\d?)";break;case "zzz":F="([+-]?\\d\\d?:\\d{2})";break;case "zz":case "z":F="([+-]?\\d\\d?)";break;case "/":F="(\\"+h["/"]+")";break;default:throw"Invalid date format pattern '"+F+"'.";}F&&B.push(F);c.push(C[0])}}j(u.slice(f),B);B.push("$");u={regExp:B.join("").replace(/\s+/g,
"\\s+"),groups:c};i=r[i]=u}m=RegExp(i.regExp).exec(g);if(m===null)return null;x=i.groups;var M=g=null,J=null,O=i=null;c=B=u=r=0;C=null;f=false;F=0;for(I=x.length;F<I;F++){var N=m[F+1];if(N){var P=x[F],K=P.length,L=parseInt(N,10);switch(P){case "dd":case "d":i=L;if(i<1||i>31)return null;break;case "MMM":case "MMMM":J=h;K=K===3;P=J.months;var Q=J.monthsGenitive||J.months,R=J._upperMonths;L=J._upperMonthsGen;if(!R){J._upperMonths=R=[v(P.names),v(P.namesAbbr)];J._upperMonthsGen=L=[v(Q.names),v(Q.namesAbbr)]}N=
H(N);J=q(K?R[1]:R[0],N);if(J<0)J=q(K?L[1]:L[0],N);if(J<0||J>11)return null;break;case "M":case "MM":J=L-1;if(J<0||J>11)return null;break;case "y":case "yy":case "yyyy":if(K<4){M=h;N=L;L=new Date;P=z(L);if(N<100){K=M.twoDigitYearMax;K=typeof K==="string"?(new Date).getFullYear()%100+parseInt(K,10):K;M=o(L,M,P);N+=M-M%100;if(N>K)N-=100}M=N}else M=L;if(M<0||M>9999)return null;break;case "h":case "hh":r=L;if(r===12)r=0;if(r<0||r>11)return null;break;case "H":case "HH":r=L;if(r<0||r>23)return null;break;
case "m":case "mm":u=L;if(u<0||u>59)return null;break;case "s":case "ss":B=L;if(B<0||B>59)return null;break;case "tt":case "t":f=h.PM&&(N===h.PM[0]||N===h.PM[1]||N===h.PM[2]);if(!f&&(!h.AM||N!==h.AM[0]&&N!==h.AM[1]&&N!==h.AM[2]))return null;break;case "f":case "ff":case "fff":c=L*Math.pow(10,3-K);if(c<0||c>999)return null;break;case "ddd":case "dddd":O=N;N=K===3;L=void 0;L=h.days;K=h._upperDays;if(!K)h._upperDays=K=[v(L.names),v(L.namesAbbr),v(L.namesShort)];O=H(O);if(N){L=q(K[1],O);if(L===-1)L=q(K[2],
O)}else L=q(K[0],O);O=L;if(O<0||O>6)return null;break;case "zzz":K=N.split(/:/);if(K.length!==2)return null;C=parseInt(K[0],10);if(C<-12||C>13)return null;K=parseInt(K[1],10);if(K<0||K>59)return null;C=C*60+(N.indexOf("-")===0?-K:K);break;case "z":case "zz":C=L;if(C<-12||C>13)return null;C*=60;break;case "g":case "gg":if(!N||!h.eras)return null;N=s(N.toLowerCase());K=0;for(L=h.eras.length;K<L;K++)if(N===h.eras[K].name.toLowerCase()){g=K;break}if(g===null)return null}}}m=new Date;x=(F=h.convert)?F.fromGregorian(m)[0]:
m.getFullYear();if(M===null)M=x;else if(h.eras)M+=h.eras[g||0].offset;if(J===null)J=0;if(i===null)i=1;if(F){m=F.toGregorian(M,J,i);if(m===null)return null}else{m.setFullYear(M,J,i);if(m.getDate()!==i)return null;if(O!==null&&m.getDay()!==O)return null}if(f&&r<12)r+=12;m.setHours(r,u,B,c);if(C!==null){h=m.getMinutes()-(C+m.getTimezoneOffset());m.setHours(m.getHours()+parseInt(h/60,10),h%60)}return m}function t(g,i,h){function r(K,L){var Q;Q=K+"";if(L>1&&Q.length<L){Q=F[L-2]+Q;return Q.substr(Q.length-
L,L)}return Q}function u(){if(I||M)return I;I=J.test(i);M=true;return I}function B(K,L){if(P)return P[L];switch(L){case 0:return K.getFullYear();case 1:return K.getMonth();case 2:return K.getDate()}}var c=h.calendar,f=c.convert;if(!i||!i.length||i==="i"){if(h&&h.name.length)if(f)h=t(g,c.patterns.F,h);else{h=new Date(g.getTime());var m=z(g,c.eras);h.setFullYear(o(g,c,m));h=h.toLocaleString()}else h=g.toString();return h}m=c.eras;var x=i==="s";i=w(c,i);h=[];var C,F=["0","00","000"],I,M,J=/([^d]|^)(d|dd)([^d]|$)/g,
O=0,N=e(),P;if(!x&&f)P=f.fromGregorian(g);for(;;){C=N.lastIndex;f=N.exec(i);C=i.slice(C,f?f.index:i.length);O+=j(C,h);if(!f)break;if(O%2)h.push(f[0]);else{C=f[0];f=C.length;switch(C){case "ddd":case "dddd":h.push((f===3?c.days.namesAbbr:c.days.names)[g.getDay()]);break;case "d":case "dd":I=true;h.push(r(B(g,2),f));break;case "MMM":case "MMMM":C=B(g,1);h.push(c.monthsGenitive&&u()?c.monthsGenitive[f===3?"namesAbbr":"names"][C]:c.months[f===3?"namesAbbr":"names"][C]);break;case "M":case "MM":h.push(r(B(g,
1)+1,f));break;case "y":case "yy":case "yyyy":C=P?P[0]:o(g,c,z(g,m),x);if(f<4)C%=100;h.push(r(C,f));break;case "h":case "hh":C=g.getHours()%12;if(C===0)C=12;h.push(r(C,f));break;case "H":case "HH":h.push(r(g.getHours(),f));break;case "m":case "mm":h.push(r(g.getMinutes(),f));break;case "s":case "ss":h.push(r(g.getSeconds(),f));break;case "t":case "tt":C=g.getHours()<12?c.AM?c.AM[0]:" ":c.PM?c.PM[0]:" ";h.push(f===1?C.charAt(0):C);break;case "f":case "ff":case "fff":h.push(r(g.getMilliseconds(),3).substr(0,
f));break;case "z":case "zz":C=g.getTimezoneOffset()/60;h.push((C<=0?"+":"-")+r(Math.floor(Math.abs(C)),f));break;case "zzz":C=g.getTimezoneOffset()/60;h.push((C<=0?"+":"-")+r(Math.floor(Math.abs(C)),2)+":"+r(Math.abs(g.getTimezoneOffset()%60),2));break;case "g":case "gg":c.eras&&h.push(c.eras[z(g,m)].name);break;case "/":h.push(c["/"]);break;default:throw"Invalid date format pattern '"+C+"'.";}}}return h.join("")}var y={},G={en:{}};G["default"]=G.en;y.extend=function(g){for(var i=arguments[1]||{},
h=2,r=arguments.length;h<r;h++){var u=arguments[h];if(u)for(var B in u){var c=u[B];if(typeof c!=="undefined")if(g&&(k.call(c)==="[object Object]"||A(c))){var f=i[B];f=f&&(k.call(f)==="[object Object]"||A(f))?f:A(c)?[]:{};i[B]=this.extend(true,f,c)}else i[B]=c}}return i};y.findClosestCulture=function(g){var i;if(!g)return this.culture||this.cultures["default"];if(k.call(g)==="[object String]")g=g.split(",");if(A(g)){var h,r=this.cultures,u=g,B,c=u.length,f=[];for(B=0;B<c;B++){g=s(u[B]);g=g.split(";");
h=s(g[0]);if(g.length===1)g=1;else{g=s(g[1]);if(g.indexOf("q=")===0){g=g.substr(2);g=parseFloat(g,10);g=isNaN(g)?0:g}else g=1}f.push({lang:h,pri:g})}f.sort(function(x,C){return x.pri<C.pri?1:-1});for(B=0;B<c;B++){h=f[B].lang;if(i=r[h])return i}for(B=0;B<c;B++){h=f[B].lang;do{u=h.lastIndexOf("-");if(u===-1)break;h=h.substr(0,u);if(i=r[h])return i}while(1)}for(B=0;B<c;B++){h=f[B].lang;for(var m in r){u=r[m];if(u.language==h)return u}}}else if(typeof g==="object")return g;return i||null};y.preferCulture=
function(g){this.culture=this.findClosestCulture(g)||this.cultures["default"]};y.localize=function(g,i,h){if(typeof i!=="string")i=this.culture.name||this.culture||"default";i=this.cultures[i]||{name:i};var r=G[i.name];if(arguments.length===3){r||(r=G[i.name]={});r[g]=h}else{if(r)h=r[g];if(typeof h==="undefined"){if(r=G[i.language])h=r[g];if(typeof h==="undefined")h=G["default"][g]}}return typeof h==="undefined"?null:h};y.format=function(g,i,h){h=this.findClosestCulture(h);if(typeof g==="number"){var r=
g;if(!i||i==="i")g=h.name.length?r.toLocaleString():r.toString();else{i=i||"D";h=h.numberFormat;g=Math.abs(r);var u=-1;if(i.length>1)u=parseInt(i.slice(1),10);var B=i.charAt(0).toUpperCase(),c;switch(B){case "D":i="n";if(u!==-1)g=D(""+g,u,true);if(r<0)g=-g;break;case "N":c=h;case "C":c=c||h.currency;case "P":c=c||h.percent;i=r<0?c.pattern[0]:c.pattern[1]||"n";if(u===-1)u=c.decimals;b:{var f=g*(B==="P"?100:1);B=c;c=B.groupSizes;g=c[0];r=1;var m=Math.pow(10,u),x=Math.round(f*m)/m;isFinite(x)||(x=f);
m="";m=(x+"").split(/e/i);x=m.length>1?parseInt(m[1],10):0;f=m[0];m=f.split(".");f=m[0];m=m.length>1?m[1]:"";if(x>0){m=D(m,x,false);f+=m.slice(0,x);m=m.substr(x)}else if(x<0){x=-x;f=D(f,x+1);m=f.slice(-x,f.length)+m;f=f.slice(0,-x)}m=u>0?B["."]+(m.length>u?m.slice(0,u):D(m,u)):"";u=f.length-1;B=B[","];for(x="";u>=0;){if(g===0||g>u){g=f.slice(0,u+1)+(x.length?B+x+m:m);break b}x=f.slice(u-g+1,u+1)+(x.length?B+x:"");u-=g;if(r<c.length){g=c[r];r++}}g=f.slice(0,u+1)+B+x+m}break;default:throw"Bad number format specifier: "+
B;}c=/n|\$|-|%/g;for(r="";;){u=c.lastIndex;B=c.exec(i);r+=i.slice(u,B?B.index:i.length);if(!B)break;switch(B[0]){case "n":r+=g;break;case "$":r+=h.currency.symbol;break;case "-":if(/[1-9]/.test(g))r+=h["-"];break;case "%":r+=h.percent.symbol}}g=r}}else if(g instanceof Date)g=t(g,i,h);return g};y.parseInt=function(g,i,h){return Math.floor(this.parseFloat(g,i,h))};y.parseFloat=function(g,i,h){if(typeof i==="string"){h=i;i=10}h=this.findClosestCulture(h);var r=NaN,u=h.numberFormat;if(g.indexOf(h.numberFormat.currency.symbol)>
-1){g=g.replace(h.numberFormat.currency.symbol,"");g=g.replace(h.numberFormat.currency["."],h.numberFormat["."])}g=s(g);if(p.test(g))r=parseFloat(g,i);else if(!i&&b.test(g))r=parseInt(g,16);else{h=E(g,u,u.pattern[0]);i=h[0];h=h[1];if(i===""&&u.pattern[0]!=="-n"){h=E(g,u,"-n");i=h[0];h=h[1]}i=i||"+";var B;g=h.indexOf("e");if(g<0)g=h.indexOf("E");if(g<0){B=h;g=null}else{B=h.substr(0,g);g=h.substr(g+1)}var c=u["."],f=B.indexOf(c);if(f<0){h=B;B=null}else{h=B.substr(0,f);B=B.substr(f+c.length)}c=u[","];
h=h.split(c).join("");f=c.replace(/\u00A0/g," ");if(c!==f)h=h.split(f).join("");i+=h;if(B!==null)i+="."+B;if(g!==null){u=E(g,u,"-n");i+="e"+(u[0]||"+")+u[1]}if(a.test(i))r=parseFloat(i)}return r};y.parseDate=function(g,i,h){h=this.findClosestCulture(h);var r,u;if(i){if(typeof i==="string")i=[i];if(i.length){u=0;for(var B=i.length;u<B;u++){var c=i[u];if(c)if(r=n(g,c,h))break}}}else{i=h.calendar.patterns;for(u in i)if(r=n(g,i[u],h))break}return r||null};var d=y.cultures=y.cultures||{};d=d["default"]=
d.en=y.extend(true,{name:"en",englishName:"English",nativeName:"English",isRTL:false,language:"en",numberFormat:{pattern:["-n"],decimals:2,",":",",".":".",groupSizes:[3],"+":"+","-":"-",percent:{pattern:["-n %","n %"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"%"},currency:{pattern:["($n)","$n"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"$"}},calendars:{standard:{name:"Gregorian_USEnglish","/":"/",":":":",firstDay:0,days:{names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday",
"Saturday"],namesAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],namesShort:["Su","Mo","Tu","We","Th","Fr","Sa"]},months:{names:["January","February","March","April","May","June","July","August","September","October","November","December",""],namesAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""]},AM:["AM","am","AM"],PM:["PM","pm","PM"],eras:[{name:"A.D.",start:null,offset:0}],twoDigitYearMax:2029,patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",t:"h:mm tt",T:"h:mm:ss tt",
f:"dddd, MMMM dd, yyyy h:mm tt",F:"dddd, MMMM dd, yyyy h:mm:ss tt",M:"MMMM dd",Y:"yyyy MMMM",S:"yyyy'-'MM'-'dd'T'HH':'mm':'ss"}}}},d.en);d.calendar=d.calendar||d.calendars.standard;var l=/^\s+|\s+$/g,p=/^[+-]?infinity$/i,b=/^0x[a-f0-9]+$/i,a=/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/,k=Object.prototype.toString;jQuery.global=y})();timeglider=window.timeglider||{version:"0.1.0"};timeglider.TG_Date={};
(function(s){function D(e){return parseInt(e,10)}function A(e){var n=parseInt(e,10);return n>9||n<0?String(e):"0"+n}s=timeglider;var q=jQuery,E={},z={},H={},v={},o={},j=/^(\-?\d+)?(\-\d{1,2})?(\-\d{1,2})?(?:T| )?(\d{1,2})?(?::)?(\d{1,2})?(?::)?(\d{1,2})?(\+|\-)?(\d{1,2})?(?::)?(\d{1,2})?/;s.TG_Date=function(e,n,t){var y,G,d;t=t||0;if(typeof e=="number"){y=G=w.getDateFromSec(e);d=e+t}else if(typeof e!=="object"){if(e=="today")e=w.getToday();y=G=e}if(j.test(y)){e=w.parse8601(y);if(e.tz_ho)e=w.toFromUTC(e,
{hours:e.tz_ho,minutes:e.tz_mi},"to");q.extend(this,e);this.rd=w.getRataDie(this);this.mo_num=this.ye>0?(this.ye-1)*12+this.mo:-1*((Math.abs(this.ye)-1)*12+(12-(this.mo-1)));if(!d){d=Math.abs(this.rd)*86400;e=this.ho*3600;y=(this.mi-1)*60;t=1;if(this.rd<0)t=-1;d=t*(d+e+y)}this.sec=d;this.date_display=n?n.toLowerCase().substr(0,2):"da";this.dateStr=G}else return{error:"invalid date"};return this};var w=s.TG_Date;w.getTimeUnitSerial=function(e,n){var t=0;switch(n){case "da":t=e.rd;break;case "mo":t=
e.mo_num;break;case "ye":t=e.ye;break;case "de":t=Math.floor(e.ye/10);break;case "ce":t=Math.floor(e.ye/100);break;case "thou":t=Math.floor(e.ye/1E3);break;case "tenthou":t=Math.floor(e.ye/1E4);break;case "hundredthou":t=Math.floor(e.ye/1E5);break;case "mill":t=Math.floor(e.ye/1E6);break;case "tenmill":t=Math.floor(e.ye/1E7);break;case "hundredmill":t=Math.floor(e.ye/1E8);break;case "bill":t=Math.floor(e.ye/1E9)}return t};w.getMonthDays=function(e,n){return w.isLeapYear(n)==true&&e==2?29:w.monthsDayNums[e]};
w.twentyFourToTwelve=function(e){var n={};n.ye=e.ye;n.mo=e.mo;n.da=e.da;n.ho=e.ho;n.mi=e.mi;n.ampm="am";if(e.ho)if(e.ho>=12){n.ampm="pm";n.ho=e.ho>12?e.ho-12:12}else if(e.ho==0){n.ho=12;n.ampm="am"}else n.ho=e.ho;else{n.ho=12;n.mi=0;n.ampm="am"}return n};w.getMonthAdj=function(e,n){var t=w.getDateFromMonthNum(e);switch(t.mo){case 1:case 3:case 5:case 7:case 8:case 10:case 12:t=Math.floor(n+n/28*3);return{width:t,days:31};case 2:if(w.isLeapYear(t.ye)==true){t=Math.floor(n+n/28);return{width:t,days:29}}else return{width:n,
days:28};default:t=Math.floor(n+n/28*2);return{width:t,days:30}}};w.getDateFromMonthNum=function(e){var n=0;if(e>0){n=e%12;if(n==0)n=12;e=Math.ceil(e/12)}else{n=Math.abs(e)%12;n=12-n+1;if(n==13)n=1;e=-1*Math.ceil(Math.abs(e)/12)}return{ye:e,mo:n}};w.getMonthWidth=function(e,n,t){var y=t/28,G;switch(e){case 1:case 3:case 5:case 7:case 8:case 10:case 12:G=3;break;case 4:case 6:case 9:case 11:G=2;break;case 2:G=w.isLeapYear(n)==true?1:0}return{width:Math.floor(t+y*G),numDays:28+G}};w.getToday=function(){var e=
new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":00"};w.getMonthFromRemDays=function(e,n){var t=0;var y=t=0;t=w.isLeapYear(n)?1:0;if(e<=31){y=1;t=e}else if(e>31&&e<=59+t){y=2;t=e-(31+t)}else if(e>59+t&&e<=90+t){y=3;t=e-(59+t)}else if(e>90+t&&e<=120+t){y=4;t=e-(90+t)}else if(e>120+t&&e<=151+t){y=5;t=e-(120+t)}else if(e>151+t&&e<=181+t){y=6;t=e-(151+t)}else if(e>181+t&&e<=212+t){y=7;t=e-(181+t)}else if(e>212+t&&e<=243+t){y=8;t=e-(212+t)}else if(e>
243+t&&e<=273+t){y=9;t=e-(243+t)}else if(e>273+t&&e<=304+t){y=10;t=e-(273+t)}else if(e>304+t&&e<=334+t){y=11;t=e-(304+t)}else{y=12;t=e-(334+t)}return{mo:y,da:t}};w.getDateFromRD=function(e){if(v[e])return v[e];for(var n=Math.floor(e),t=Math.floor(n/146097)*400,y=n-Math.floor(n/146097)*146097,G=1,d=t+1,l=d+400;d<=l;d++)if(y>365){y-=365;if(w.isLeapYear(d))y-=1;G++}else d=l;t+=G;if(y==0)y=1;y=w.getMonthFromRemDays(y,t);G=(e-n)*1440;n=Math.floor(G%60);G=Math.floor(G/60);if(w.isLeapYear(t)&&y.mo==2)y.da+=
1;n=t+"-"+y.mo+"-"+y.da+" "+G+":"+n+":00";return v[e]=n};w.getDateFromSec=function(e){if(o[e])return o[e];var n=w.getDateFromRD(e/86400);return o[e]=n};w.isLeapYear=function(e){return e%400==0?true:e%100==0?false:e%4==0?true:false};w.getRataDie=function(e){function n(b,a){if(z[b+"-"+a])return z[b+"-"+a];for(var k=0,g=b;g<a;g++)k+=w.isLeapYear(g)?366:365;return z[b+"-"+a]=k}function t(b,a){var k;switch(b){case 1:k=0;break;case 2:k=31;break;case 3:k=59;break;case 4:k=90;break;case 5:k=120;break;case 6:k=
151;break;case 7:k=181;break;case 8:k=212;break;case 9:k=243;break;case 10:k=273;break;case 11:k=304;break;case 12:k=334}if(b>2)if(w.isLeapYear(a))k+=1;return k}var y=e.ye,G=e.mo;e=e.da;var d=0;if(E[y+"-"+G+"-"+e])return E[y+"-"+G+"-"+e];if(y>=0){if(y==0)y=1;d=Math.floor(y/400)*146097;var l=parseInt(n(y-y%400,y)),p=parseInt(t(G,y));d=d+l+p+e-366}else if(y<0)d=w.getBCRataDie({ye:y,mo:G,da:e});return E[y+"-"+G+"-"+e]=d};w.monthNamesLet=["","J","F","M","A","M","J","J","A","S","O","N","D"];w.monthsDayNums=
[0,31,28,31,30,31,30,31,31,30,31,30,31,29];w.units=["da","mo","ye","de","ce","thou","tenthou","hundredthou","mill","tenmill","hundredmill","bill"];w.getBCRataDie=function(e){var n=e.ye,t=e.mo;e=e.da;if(H[n+"-"+t+"-"+e])return H[n+"-"+t+"-"+e];if(t==0)t=1;if(e==0)e=1;var y=-1*((Math.abs(n)-1)*366+[0,335,306,275,245,214,184,153,122,92,61,31,0][t]+(w.monthsDayNums[t]-e+1));return H[n+"-"+t+"-"+e]=y};w.setCulture=function(e){jQuery.global.culture=jQuery.global.cultures[e];w.monthNames=q.merge([""],jQuery.global.culture.calendar.months.names);
w.monthNamesAbbr=q.merge([""],jQuery.global.culture.calendar.months.namesAbbr);w.dayNames=jQuery.global.culture.calendar.days.names;w.dayNamesAbbr=jQuery.global.culture.calendar.days.namesAbbr;w.dayNamesShort=jQuery.global.culture.calendar.days.namesShort;w.patterns=jQuery.global.culture.calendar.patterns};w.prototype={format:function(e,n,t){t=t||{hours:0,minutes:0};if(n==true)switch(this.date_display.substr(0,2)){case "no":return"";case "ye":e="yyyy";break;case "mo":e="MMM yyyy";break;case "da":e=
"MMM d, yyyy";break;case "ho":e="MMM d, yyyy h:mm tt";break;default:e="f"}if(this.ye>-27E4){n=w.toFromUTC(_.clone(this),t,"from");n=new Date(n.ye,n.mo-1,n.da,n.ho,n.mi,n.se,0);return q.global.format(n,e)}else return this.ye}};w.getTimeOffset=function(e){e=e.replace(/[^-\d:]/gi,"");var n=e.split(":"),t=parseInt(n[0],10);n=parseInt(n[1],10);var y=t+(t<0?-1:1)*(n/60);return{decimal:y,hours:t,minutes:n,seconds:y*3600,string:e}};w.tzOffsetStr=function(e,n){if(e){if(e.length==19)e+=n;else if(e.length==
16)e+=":00"+n;return e}};w.parse8601=function(e){var n,t,y,G,d,l,p,b;d=function(a){return a?parseInt(a.replace("-",""),10):0};b=e.match(j);e=parseInt(b[1]);if(!e)return{error:"invalid date; no year provided"};n=d(b[2])||1;t=d(b[3])||1;y=d(b[4])||1;G=d(b[5])||0;d=d(b[6])||0;l=b[7]||"+";p=parseInt(b[8],10)||0;if(l=="-")p*=-1;b=parseInt(b[9],10)||0;if(l=="-")b*=-1;return{ye:e,mo:n,da:t,ho:y,mi:G,se:d,tz_ho:p,tz_mi:b}};w.getLastDayOfMonth=function(e,n){var t=[0,31,28,31,30,31,30,31,31,30,31,30,31],y=
0;return y=n==2&&w.isLeapYear(e)==true?29:t[n]};w.getDateTimeStrings=function(e){var n=w.parse8601(e);e=n.ye+"-"+A(n.mo)+"-"+A(n.da);var t="pm";if(n.ho>12){n.ho-=12;t="pm"}else{if(n.ho==0)n.ho="12";t="am"}n=D(n.ho)+":"+A(n.mi)+" "+t;return{date:e,time:n}};w.transValidateDateString=function(e){if(!e)return false;var n=e.match(/^(\-?\d+|today|now) ?(bce?)?-?(\d{1,2})?-?(\d{1,2})?/);e=w.zeroButt;if(n){var t=n[1],y=n[2]||"",G=n[3]||"07";n=n[4]||"1";if(parseInt(t,10)<0||y.substr(0,1)=="b")t=-1*Math.abs(t);
return w.validateDate(t,G,n)?t+"-"+e(G)+"-"+e(n):false}else return false};w.transValidateTimeString=function(e){if(!e)return"12:00:00";e=e.toLowerCase().match(/^(\d{1,2}|noon):?(\d{1,2})?:?(\d{1,2})? ?(am|pm)?/i);var n="";n=w.zeroButt;if(e[1])if(e[0]=="noon")n="12:00:00";else{var t=parseInt(e[1],10)||12,y=parseInt(e[2],10)||0,G=parseInt(e[3],10)||0;e=e[4]||"am";if(w.validateTime(t,y,G)==false)return false;if(e=="pm"&&t<12)t+=12;n=n(t)+":"+n(y)+":"+n(G)}else n=false;return n};w.validateTime=function(e,
n,t){if(e<0||e>23||n<0||n>59||t<0||t>59)return false;return true};w.validateDate=function(e,n,t){var y=w.getMonthDays(n,e);if(t>y||t<=0)return false;if(n>12||n<0)return false;if(e==0)return false;return true};w.zeroButt=function(e){e=parseInt(e,10);return e>9?String(e):"0"+e};w.toFromUTC=function(e,n,t){var y=0,G=[0,31,28,31,30,31,30,31,31,30,31,30,31,29];y={};if(t=="from"){y.ho=-1*n.hours;y.mi=-1*n.minutes}else if(t=="to"){y.ho=n.hours;y.mi=n.minutes}else{y.ho=-1*e.tz_ho;y.mi=-1*e.tz_mi}if(y.ho==
0&&y.mi==0)return e;t=e.ho+e.mi/60+(-1*y.ho+y.mi*-1/60);if(t<0){y=24+t;if(e.da>1)e.da-=1;else if(e.mo==1){e.ye-=1;e.mo=12;e.da=31}else{e.mo-=1;e.da=w.getLastDayOfMonth(e.ye,e.mo)}}else if(t>=24){y=t-24;if(w.isLeapYear(e.ye)&&e.mo==2&&e.da==28)e.da=29;else if(e.da==G[e.mo]){if(e.mo==12){e.ye+=1;e.mo=1}else e.mo+=1;e.da=1}else e.da+=1}else y=t;G=function(d){d=Math.abs(d);var l=Math.floor(d);return{ho:l,mi:Math.round((d-l)*60),se:0}}(y);e.ho=G.ho;e.mi=G.mi;if(n){e.tz_ho=n.tz_ho;e.tz_mi=n.tz_mi}else{e.tz_ho=
0;e.tz_mi=0}return{ye:e.ye,mo:e.mo,da:e.da,ho:e.ho,mi:e.mi,se:e.se}};w.timezones=[{offset:"-12:00",name:"Int'l Date Line West"},{offset:"-11:00",name:"Bering & Nome"},{offset:"-10:00",name:"Alaska-Hawaii Standard Time"},{offset:"-10:00",name:"U.S. Hawaiian Standard Time"},{offset:"-10:00",name:"U.S. Central Alaska Time"},{offset:"-09:00",name:"U.S. Yukon Standard Time"},{offset:"-08:00",name:"U.S. Pacific Standard Time"},{offset:"-07:00",name:"U.S. Mountain Standard Time"},{offset:"-07:00",name:"U.S. Pacific Daylight Time"},
{offset:"-06:00",name:"U.S. Central Standard Time"},{offset:"-06:00",name:"U.S. Mountain Daylight Time"},{offset:"-05:00",name:"U.S. Eastern Standard Time"},{offset:"-05:00",name:"U.S. Central Daylight Time"},{offset:"-04:00",name:"U.S. Atlantic Standard Time"},{offset:"-04:00",name:"U.S. Eastern Daylight Time"},{offset:"-03:30",name:"Newfoundland Standard Time"},{offset:"-03:00",name:"Brazil Standard Time"},{offset:"-03:00",name:"Atlantic Daylight Time"},{offset:"-03:00",name:"Greenland Standard Time"},
{offset:"-02:00",name:"Azores Time"},{offset:"-01:00",name:"West Africa Time"},{offset:"00:00",name:"Greenwich Mean Time/UTC"},{offset:"00:00",name:"Western European Time"},{offset:"01:00",name:"Central European Time"},{offset:"01:00",name:"Middle European Time"},{offset:"01:00",name:"British Summer Time"},{offset:"01:00",name:"Middle European Winter Time"},{offset:"01:00",name:"Swedish Winter Time"},{offset:"01:00",name:"French Winter Time"},{offset:"02:00",name:"Eastean EU"},{offset:"02:00",name:"USSR-zone1"},
{offset:"02:00",name:"Middle European Summer Time"},{offset:"02:00",name:"French Summer Time"},{offset:"03:00",name:"Baghdad Time"},{offset:"03:00",name:"USSR-zone2"},{offset:"03:30",name:"Iran"},{offset:"04:00",name:"USSR-zone3"},{offset:"05:00",name:"USSR-zone4"},{offset:"05:30",name:"Indian Standard Time"},{offset:"06:00",name:"USSR-zone5"},{offset:"06:30",name:"North Sumatra Time"},{offset:"07:00",name:"USSR-zone6"},{offset:"07:00",name:"West Australian Standard Time"},{offset:"07:30",name:"Java"},
{offset:"08:00",name:"China & Hong Kong"},{offset:"08:00",name:"USSR-zone7"},{offset:"08:00",name:"West Australian Daylight Time"},{offset:"09:00",name:"Japan"},{offset:"09:00",name:"Korea"},{offset:"09:00",name:"USSR-zone8"},{offset:"09:30",name:"South Australian Standard Time"},{offset:"09:30",name:"Central Australian Standard Time"},{offset:"10:00",name:"Guam Standard Time"},{offset:"10:00",name:"USSR-zone9"},{offset:"10:00",name:"East Australian Standard Time"},{offset:"10:30",name:"Central Australian Daylight Time"},
{offset:"10:30",name:"South Australian Daylight Time"},{offset:"11:00",name:"USSR-zone10"},{offset:"11:00",name:"East Australian Daylight Time"},{offset:"12:00",name:"New Zealand Standard Time"},{offset:"12:00",name:"Int'l Date Line East"},{offset:"13:00",name:"New Zealand Daylight Time"}];w.boil=D;w.unboil=A})(timeglider);(function(s){var D=s.levelHeight=8;s.TG_Org=function(){var A=this,q=s.icon_folder;this.blocks=[];this.ids=[];this.vis=[];this.tree=[];this.pol=-1;this.addBlock=function(o,j){o.right=o.left+o.width;o.bottom=o.top+o.height;o.tickScope=j;A.blocks.push(o)};this.getBorg=function(){return this};this.getBlocks=function(){return this.blocks};this.getHTML=function(o,j){if(o=="sweep"){E();this.vis=[]}this.blocks.sort(z);var w,e,n="",t="",y="",G=0,d={},l=this.blocks.length;e="";var p=0,b=0;w="";for(var a=function(g){b=
g>b?g:b},k=0;k<l;k++){d=this.blocks[k];p=0;w="";if(d.tickScope==o)if(_.indexOf(d.id,this.vis)==-1){this.vis.push(d.id);if(d.html&&d.html.substr(0,4)=="<div")y+="<div style='left:"+d.left+"px' id='"+d.id+"'"+d.html.substr(4);else{if(d.image){w=d.shape&&d.image.display_class=="inline"?" style='width:"+d.shape.img_wi+"px;height:auto;top:-"+d.shape.img_ht+"px'":"";p=0;n="<div class='timeglider-event-image-"+d.image.display_class+"'><img src='"+d.image.src+"' "+w+"></div>"}else n="";if(d.y_position>0)d.top=
A.pol*d.y_position;else v(d,0);a(Math.abs(d.top));e=d.span_color?";background-color:"+d.span_color:"";d.fontsize<10?d.opacity=d.fontsize/10:d.opacity=1;if(d.span==true){w="timeglider-event-spanning";e="<div class='timeglider-event-spanner' style='top:px;height:"+d.fontsize+"px;width:"+d.spanwidth+"px"+e+"'></div>"}else e=w="";t=d.icon?"<img class='timeglider-event-icon' src='"+q+d.icon+"' style='height:"+d.fontsize+"px;left:-"+(d.fontsize+2)+"px; top:"+p+"px'>":"";if(j&&A.pol==-1&&Math.abs(d.top)>
j-16)y+="<div class='timeglider-more-plus' style='left:"+d.left+"px; top:-"+(j-Math.floor(16/3))+"px'>+</div>";else{G=A.pol===1?42:0;y+="<div class='timeglider-timeline-event "+d.css_class+" "+w+"' id='"+d.id+"' style='width:"+d.width+"px;height:"+d.height+"px;left:"+d.left+"px;opacity:"+d.opacity+";top:"+(d.top+G)+"px;font-size:"+d.fontsize+"px;'>"+t+n+e+"<div class='timeglider-event-title' style='top:"+p+"px'>"+d.title+"</div></div>"}}}}return{html:y,highest:b}};var E=function(){A.tree=[];for(var o=
0;o<300;o++)A.tree[o]=[]},z=function(o,j){var w=j.importance,e=o.importance;if(o.image&&!j.image)return-1;return w<e?-1:w>e?1:0},H=function(o,j){if(!(j.left>o.right||j.right<o.left))if(j.left>=o.left&&j.left<=o.right||j.right>=o.left&&j.right<=o.right||j.right>=o.right&&j.left<=o.left||j.right<=o.right&&j.left>=o.left)if(j.bottom<=o.bottom&&j.bottom>=o.top||j.top<=o.bottom&&j.top>=o.top||j.top==o.bottom&&j.top==o.top)return true;return false},v=function(o,j){var w=false,e=A.tree,n=e[j],t=j+1,y=false;
w=2;var G=0,d=false;if(n!=undefined){for(var l=0;l<n.length;l++){w=H(n[l],o);if(o.shape)d=H(n[l],o.shape);if(w==true||d==true){if(A.pol===-1){o.top-=D;o.bottom-=D}else{o.top+=D;o.bottom+=D}v(o,t);y=true;break}}if(y==false){if(A.pol===-1)o.top-=o.fontsize;else o.top+=o.fontsize;n.push(o);w=Math.ceil(o.height/D);for(t=1;t<=w;t++){n=j+t;if(n<=300){e[n].push(o);G=n}else debug.log("too many levels!")}if(o.shape){y=o.shape;n=0;t=Math.ceil(y.img_ht/D);n=o.top-4;y={left:o.left,right:o.left+y.img_wi+12,bottom:n,
top:n-y.img_ht};for(w=1;w<=t;w++){n=G+w;n<=300&&e[n].push(y)}}}}}}})(timeglider);(function(s){var D=s.TG_Date,A=jQuery,q=D.units,E;s.TG_EventCollection=Backbone.Collection.extend({eventHash:{},setTimelineHash:function(z,H){this.eventHash[z]=H},getTimelineHash:function(z){return this.eventHash[z]},model:s.TG_Event});s.TG_Event=Backbone.Model.extend({urlRoot:"/event",defaults:{title:"Untitled"},initialize:function(z){if(z.image){if(typeof z.image=="string")z.image={id:z.id,src:z.image,display_class:z.image_class||"above",width:0,height:0};else{z.image.display_class=z.image.display_class||
"above";z.image.width=0;z.image.height=0}this.getEventImageSize(z.image)}else z.image="";z.titleWidth=s.getStringWidth(z.title);this.set(z)},validate:function(){},getEventImageSize:function(z){function H(w,e){return function(){return e.apply(w,arguments)}}var v=this,o=new Image,j=o.src=z.src;o.onerror=H(o,function(){debug.log("error loading image:"+j);v.set({image:""})});o.onload=H(o,function(){v.get("image").height=this.height;v.get("image").width=this.width})}});s.TG_TimelineCollection=Backbone.Collection.extend({model:s.TG_Timeline});
s.TG_Timeline=Backbone.Model.extend({urlRoot:"/timeline",defaults:{initial_zoom:25,timezone:"00:00",title:"Untitled",events:[],legend:[]},_chewTimeline:function(z){E=z.mediator;z.timeline_id=z.id;var H={all:[],da:[],mo:[],ye:[],de:[],ce:[],thou:[],tenthou:[],hundredthou:[],mill:[],tenmill:[],hundredmill:[],bill:[]};z.spans={};z.hasImagesAbove=false;z.startSeconds=[];z.endSeconds=[];z.size_importance=z.size_importance=="false"?false:true;z.timeOffset=D.getTimeOffset(z.timezone||"00:00");if(!z.color)z.color=
"#333333";if(z.events.length>0){for(var v,o,j,w,e=z.events.length,n=0;n<e;n++){o=z.events[n];if(o.id)j=o.id;else o.id=j="anon"+this.anonEventId++;if(o.map)if(E.main_map){if(timeglider.mapping.ready)o.map.marker_instance=timeglider.mapping.addAddMarkerToMap(o,E.main_map)}else s.googleMapsLoad();v=o.date_display||o.date_limit||"da";o.date_display=v.toLowerCase().substr(0,2);if(z.timeOffset.seconds){o.startdate=D.tzOffsetStr(o.startdate,z.timeOffset.string);if(o.enddate)o.enddate=D.tzOffsetStr(o.enddate,
z.timeOffset.string)}o.startdateObj=new D(o.startdate,o.date_display);if(o.enddate&&o.enddate!==o.startdate){o.enddateObj=new D(o.enddate,o.date_display);o.span=true;z.spans["s_"+o.id]={id:o.id,start:o.startdateObj.sec,end:o.enddateObj.sec}}else{o.enddateObj=o.startdateObj;o.span=false}if(o.image)if(o.image.display_class!="inline")z.hasImagesAbove=true;z.startSeconds.push(o.startdateObj.sec);z.endSeconds.push(o.enddateObj.sec);o.cache={span:o.span,startdateObj:_.clone(o.startdateObj),enddateObj:_.clone(o.enddateObj)};
o.icon=!o.icon||o.icon==="none"?"":o.icon;H.all.push(j);for(var t=q.length,y=0;y<t;y++){v=q[y];w=D.getTimeUnitSerial(o.startdateObj,v);if(H[v][w]!==undefined)H[v][w].push(j);else H[v][w]=[j]}if(E.eventCollection.get(j))E.eventCollection.get(j).get("timelines").push(z.timeline_id);else{o.timelines=[z.timeline_id];o=new s.TG_Event(o);E.eventCollection.add(o)}}e=A.merge(z.startSeconds,z.endSeconds);e=_.sortBy(e,function(G){return parseInt(G)});z.bounds={first:_.first(e),last:_.last(e)};z.has_events=
true;e=D.getDateFromSec(z.bounds.first);debug.log("date from sec");z.focus_date=z.focus_date||e;z.focusDateObj=new D(z.focus_date);debug.log("tdata.focusDateObj:",z.focusDateObj)}else{z.has_events=false;z.focus_date=z.focus_date||"today";debug.log("hello today 357?")}z.hasLegend=z.legend.length>0?true:false;z.display="expanded";E.eventCollection.setTimelineHash(z.timeline_id,H);delete z.events;return z},initialize:function(z){this.set(this._chewTimeline(z));this.bind("change",function(){})}})})(timeglider);(function(s){var D=s.TG_Date,A="",q="",E={},z=0,H=0,v=0,o="",j=jQuery,w={},e="",n,t,y,G=j.support.touch?"touchstart":"click";s.TG_PlayerView=function(d,l){var p=this;q=l;E=q.options;A="#"+d._id;e=d._id;o=E.base_namespace+"#"+e;this._views={PLACE:A,CONTAINER:A+" .timeglider-container",DATE:A+" .timeglider-date-display",TIMELINE_MENU:A+" .timeglider-timeline-menu",TIMELINE_MENU_UL:A+" .timeglider-timeline-menu ul",TIMELINE_LIST_BT:A+" .timeglider-list-bt",SLIDER_CONTAINER:A+" .timeglider-slider-container",
SLIDER:A+" .timeglider-slider",ZOOM_DISPLAY:A+" .timeglider-zoomlevel-display",TRUCK:A+" .timeglider-truck",CENTERLINE:A+" .timeglider-centerline",TICKS:A+" .timeglider-ticks",HANDLE:A+" .timeglider-handle",FOOTER:A+" .timeglider-footer",FILTER_BT:A+" .timeglider-filter-bt",FILTER_BOX:A+" .timeglider-filter-box",SETTINGS_BT:A+" .timeglider-settings-bt"};n=this._views.CONTAINER;t=this._views.TICKS;y=this._views.DATE;this.initTimelineVOffset=100;this.tick_height=34;this.imageLaneHeight=60;this._templates=
{};this._templates={test:"testola",event_modal_small:"<div class='tg-modal timeglider-ev-modal ui-widget-content' id='${id}_modal'><div class='close-button-remove'></div><div class='dateline'>{{html dateline}}</div><h4 id='title'>${title}</h4><p>{{html image}}{{html description}}</p><ul class='timeglider-ev-modal-links'>{{html links}}</ul></div>",event_modal_full:j.template(null,"<div class='tg-modal full_modal' id='ev_${id}_modal'><div class='full_modal_scrim'></div><div class='full_modal_panel'><div class='close-button full_modal_close'>x</div><div class='dateline'>{{html dateline}}</div><table><tr><td><h4>${title}</h4><div class='description'><p>{{html description}}</p></div></td><td><div>{{html image}}</div><div id='insert'></div></td></tr></table><div class='footer'><ul>{{html links}}</ul></div></div>"),
filter_modal:j.template(null,"<div class='tg-modal timeglider-menu-modal timeglider-filter-box'><div class='close-button'></div><h3>filter</h3><div class='timeglider-menu-modal-content'><div class='timeglider-formline'>show: <input type='text' class='timeglider-filter-include'></div><div class='timeglider-formline'>hide: <input type='text' class='timeglider-filter-exclude'></div><ul><li class='timeglider-filter-clear'>clear</li><li class='timeglider-filter-apply'>apply</li></ul></div><div class='timeglider-menu-modal-point-right'></div>"),
timeline_list_modal:j.template(null,"<div class='timeglider-menu-modal timeglider-timeline-menu'><div class='close-button'></div><h3>timelines</h3><div class='timeglider-menu-modal-content'><ul></ul></div><div class='timeglider-menu-modal-point-right'></div>"),settings_modal:j.template(null,"<div class='timeglider-menu-modal timeglider-settings-modal'><div class='close-button'></div><h3>settings</h3><div class='timeglider-menu-modal-content'><div class='timeglider-settings-timezone'></div></div><div class='timeglider-menu-modal-point-right'></div>"),
legend_modal:j.template(null,"<div class='timeglider-menu-modal timeglider-legend timeglider-display-none'  id='${id}_legend'><div class='timeglider-menu-modal-content'><ul id='${id}'>{{html legend_list}}</ul><div class='timeglider-close-button-small timeglider-legend-close'></div><div class='timeglider-legend-all'>all</div></div></div>")};this.timelineModal=s.TG_TimelineView.extend({tagName:"div",model:s.TG_Timeline,className:"tg-modal timeglider-timeline-modal ui-widget-content",events:{"click .close-button-remove":"remove"},
template:"<div class='close-button-remove'></div><h4 id='title'>${title}</h4><p>{{html description}}</p>",initialize:function(){this.model.bind("change",this.render,this)},render:function(){j(this.el).html(j.tmpl(this.template,this.model.attributes)).attr("id",this.model.get("id")+"_timelineModal");return this},remove:function(){j(this.el).fadeOut()}});j(n).delegate(".tg-timeline-envelope .timeline-info","click",function(){var a=j(this).data("timeline_id");p.openTimelineModal(a)}).delegate(".tg-timeline-envelope .expand-collapse",
"click",function(){var a=j(this).data("timeline_id");p.expandCollapseTimeline(a)}).delegate(".tg-timeline-envelope .tg-timeline-legend-bt","click",function(){var a=j(this).data("timeline_id");p.legendModal(a)}).delegate(".close-button-remove","click",function(){var a=j(this).parent().attr("id");j("#"+a).remove()}).delegate(".full_modal_scrim, .full_modal_close","click",function(){j(".full_modal").remove()}).delegate(".timeglider-more-plus","click",function(){q.zoom(-1)}).delegate(".timeglider-legend-close",
"click",function(){var a=j(n+" .timeglider-legend");a.fadeOut(300,function(){a.remove()})}).delegate(".timeglider-legend-all","click",function(){j(n+" .timeglider-legend li").each(function(){j(this).removeClass("tg-legend-icon-selected")});q.setFilters({origin:"legend",icon:"all"})}).css("height",j(A).height());this.basicFontSize=E.basic_fontsize;E.show_footer==false&&j(this._views.FOOTER).css("display","none");this.dragSpeed=0;this.dimensions=q.dimensions=this.getWidgetDimensions();this.ticksHandleOffset=
this.rightside=this.leftside=this.tickNum=0;this.timeoout_id=1;this.sliderActive=false;this.ztop=1E3;this.filterBoxActivated=false;this.buildSlider();this.setupFilter();this.setPanButton(j(".timeglider-pan-right"),-30);this.setPanButton(j(".timeglider-pan-left"),30);j(this._views.TRUCK).bind("dblclick",function(a){q.registerUIEvent({name:"dblclick",event:a,dimensions:p.dimensions})}).bind("mousewheel",function(a,k){var g=Math.ceil(-1*k*3),i=q.getZoomLevel();q.setZoomLevel(i+g);return false});j(t).draggable({axis:"x",
start:function(){},drag:function(){H=Math.floor(j(this).position().left);q.setTicksOffset(H);z=H-v;v=H},stop:function(){p.resetTicksHandle();p.registerDragging()}}).delegate(n+" .timeglider-timeline-event",G,function(){var a=j(this).attr("id"),k=q.eventCollection.get(a).attributes;if(timeglider.mode!="authoring")if(k.click_callback){a=k.click_callback.split(".");var g=a.length;if(g==1)window[a[0]](k);else if(g==2)window[a[0]][a[1]](k);else if(g==3)window[a[0]][a[1]][a[2]](k)}else p.eventModal(a)}).delegate(".timeglider-timeline-event",
"mouseover",function(){var a=q.eventCollection.get(j(this).attr("id")).attributes;p.eventHover(j(this),a)}).delegate(".timeglider-timeline-event","mouseout",function(){var a=q.eventCollection.get(j(this).attr("id")).attributes;p.eventUnHover(j(this),a)}).delegate(".timeglider-event-collapsed","hover",function(){q.eventCollection.get(j(this).attr("id"))});p.setCenterline();j.subscribe(o+".mediator.ticksOffsetChange",function(){p.tickHangies();p.registerDragging();p.registerTitles()});j.subscribe(o+
".mediator.focusToEvent",function(){});j.subscribe(o+".mediator.zoomLevelChange",function(){p.tickNum=0;p.leftside=0;var a=q.getZoomLevel();j(p._views.SLIDER).slider("value",p.invSliderVal(a));p.displayZoomLevel(a);p.castTicks("zoomLevelChange")});j.subscribe(o+".viewer.rendered",function(){});j.subscribe(o+".mediator.ticksReadySignal",function(){q.ticksReady===true&&p.freshTimelines()});j.subscribe(o+".mediator.refreshSignal",function(){p.tickNum=0;p.leftside=0;p.castTicks("refreshSignal")});j.subscribe(o+
".mediator.ticksArrayChange",function(){});j.subscribe(o+".mediator.focusDateChange",function(){this.displayFocusDate()});j.subscribe(o+".mediator.timelineDataLoaded",function(){j(".timeglider-loading").fadeOut(500);p.buildSettingsMenu();p.buildTimelineMenu()});j.subscribe(o+".mediator.activeTimelinesChange",function(){j(p._views.TIMELINE_MENU_UL+" li").each(function(){var a=j(this).data("timeline_id");j.inArray(a,q.activeTimelines)!=-1?j(this).addClass("activeTimeline"):j(this).removeClass("activeTimeline")})});
j.subscribe(o+".mediator.filterChange",function(){});if(j.support.touch){j("#"+e).addTouch();var b=document.getElementById(e);b.addEventListener("gesturestart",function(a){a.preventDefault();j("#output").append("<br>gesture zoom:"+q.getZoomLevel())},false);b.addEventListener("gestureend",function(a){a.preventDefault();j("#output").append("<br>gesture end:"+q.getZoomLevel())},false);b.addEventListener("gesturechange",function(a){a.preventDefault();a.preventDefault();if(q.gesturing===false){q.gesturing=
true;q.gestureStartZoom=q.getZoomLevel()}q.setZoomLevel(Math.ceil(q.gestureStartZoom/a.scale))},false)}};s.TG_PlayerView.prototype={resize:function(){var d=j(A).height();j(n).height(d);this.dimensions=this.getWidgetDimensions();q.setDimensions(this.dimensions);this.setCenterline();q.refresh()},getWidgetDimensions:function(){var d=j(n),l=d.width(),p=Math.floor(l/2)+1,b=d.height(),a=Math.floor(b/2),k=this.tick_height,g=d.position().left;d=d.offset();var i=E.show_footer==true?j(this._views.FOOTER).height():
0;return{container:{width:l,height:b,centerx:p,centery:a,left:g,offset:d},tick:{top:b-i-k},footer:{height:i}}},scaleToImportance:function(d,l){return d/l},displayZoomLevel:function(){var d=q.getZoomLevel();d>0&&E.display_zoom_level==true&&j(this._views.ZOOM_DISPLAY).text(d)},displayFocusDate:function(){var d=q.getFocusDate();j(y).text(d.format("d MMM yyyy",false))},setPanButton:function(d,l){var p=this;j(d).live("mousedown",function(){p.intervalMachine("pan",{type:"set",fn:p.pan,args:[l],intvl:33})}).live("mouseup",
function(){p.intervalMachine("pan",{type:"clear",fn:p.pan,callback:"resetTicksHandle"})}).live("mouseout",function(){p.intervalMachine("pan",{type:"clear",fn:p.pan,callback:"resetTicksHandle"})})},intervalMachine:function(d,l){var p=this;if(l.type==="clear"){clearInterval(w[d]);if(l.callback)p[l.callback]()}else w[d]=setInterval(function(){l.fn.apply(p,l.args)},l.intvl)},invSliderVal:function(d){return Math.abs(d-101)},pan:function(d){var l=d||20;d=j(t);l=d.position().left+l;d.css({left:l});q.setTicksOffset(l)},
registerTitles:function(){var d,l,p,b,a,k,g,i,h,r,u,B=j(n).offset().left;j(".timeglider-event-spanning").each(function(){d=j(this).offset().left-B;l=j(this).outerWidth();k=j(".timeglider-event-title",this);p=k.outerWidth()+5;b=k.siblings(".timeglider-event-spanner").outerWidth();b>p&&d<0&&Math.abs(d)<l-p&&k.css({marginLeft:-1*d+5})});j.browser.msie&&parseInt(j.browser.version);j(".tg-timeline-envelope").each(function(){g=j(this);i=g.offset().left-B;h=g.find(".titleBar");a=h.data("lef");u=-1*(a+i);
r=h.find(".timeline-title");u>0&&u<h.width()-r.width()&&r.css({marginLeft:u+5})})},registerDragging:function(){var d=q.startSec,l=j(t).position().left,p=q.getZoomInfo().spp;d=new D(d-l*p);q.setFocusDate(d);this.displayFocusDate()},setupFilter:function(){var d=this;j(d._views.FILTER_BT);var l=j.tmpl(d._templates.filter_modal,{}).appendTo(d._views.CONTAINER);l.position({my:"right bottom",at:"right top",of:j(d._views.FILTER_BT),offset:"-8, -30"}).css("z-index",d.ztop++).hide();j(n).delegate(".timeglider-filter-box .close-button",
"click",function(){l.fadeOut()});j(d._views.FILTER_BT).bind("click",function(){l.fadeIn();j(this);var p=d._views.FILTER_BOX;if(d.filterBoxActivated==false){d.filterBoxActivated=true;var b=j(p+" .timeglider-filter-apply"),a=j(".timeglider-filter-box .close-button"),k=j(p+" .timeglider-filter-clear"),g="",i="";b.bind("click",function(){g=j(p+" .timeglider-filter-include").val();i=j(p+" .timeglider-filter-exclude").val();q.setFilters({origin:"clude",include:g,exclude:i});j(p).toggleClass("timeglider-display-block")});
a.bind("click",function(){j(p).toggleClass("timeglider-display-none")});k.bind("click",function(){q.setFilters({origin:"clude",include:"",exclude:""});j(p+" .timeglider-filter-include").val("");j(p+" .timeglider-filter-exclude").val("");j(p).toggleClass("timeglider-display-block")})}})},buildTimelineMenu:function(){var d=this,l;j(d._views.TIMELINE_LIST_BT);j(d._views.TIMELINE_MENU)[0]&&j(d._views.TIMELINE_MENU).remove();l=j.tmpl(d._templates.timeline_list_modal,{}).appendTo(d._views.CONTAINER);var p=
Backbone.View.extend({initialize:function(){this.model.bind("change",this.render,this)},tagName:"li",className:"timeglider-timeline-list-item",template:"${title}",events:{click:"toggleTimeline"},toggleTimeline:function(){q.toggleTimeline(this.model.get("id"))},render:function(){var b=this.model.get("id");j(this.el).html(j.tmpl(this.template,this.model.attributes)).data("timeline_id",b);return this}});j(d._views.TIMELINE_MENU_UL).html("");_.each(q.timelineCollection.models,function(b){j(d._views.TIMELINE_MENU_UL).append((new p({model:b})).render().el)});
l.position({my:"right bottom",at:"right top",of:j(d._views.TIMELINE_LIST_BT),offset:"-8, -30"}).hide();j(n).delegate(".timeglider-timeline-menu .close-button","click",function(){l.fadeOut()}).delegate(this._views.TIMELINE_LIST_BT,"click",function(){l.fadeIn()})},getTimezonePulldown:function(d,l){var p="<select name='timezone' id='"+d+"'>",b=false,a="selected";j.map(D.timezones,function(k){if(l==k.offset&&b==false){a="selected";b=true}else a="";p+="<option value='"+k.offset+"' "+a+">"+k.name+"</option>"});
p+="</select>";return p},buildSettingsMenu:function(){var d=j.tmpl(this._templates.settings_modal,{}).appendTo(this._views.CONTAINER),l=this.getTimezonePulldown("timeglider-settings-timezone",q.timeOffset.string);d.find(".timeglider-settings-timezone").append('<p>Make changes below, then click on "save". More settings options to come!</p>').append('<span class="settings-label">timezone:</span> '+l).append("<p style='clear:both'>&nbsp;</p><div class='btn success' id='timeglider-settings-save'>save</div>");
d.position({my:"right bottom",at:"right top",of:j(this._views.SETTINGS_BT),offset:"-8, -30"}).hide();j(n).delegate(".timeglider-settings-modal .close-button","click",function(){d.fadeOut()}).delegate(this._views.SETTINGS_BT,"click",function(){d.fadeIn()}).delegate("#timeglider-settings-save","click",function(){var p=j(n+" #timeglider-settings-timezone").val();q.setTimeoffset(p)})},buildSlider:function(){var d=q.getZoomLevel();if(E.min_zoom==E.max_zoom)j(this._views.SLIDER_CONTAINER).css("display",
"none");else{E.display_zoom_level==true&&j("<div>").appendTo(this._views.SLIDER_CONTAINER).addClass("timeglider-zoomlevel-display").html("&nbsp;");var l=this;d=l.invSliderVal(d);var p=q.max_zoom,b=q.min_zoom;j(this._views.SLIDER).css("height",(1+p-b)*3).slider({steps:100,handle:j(".knob"),animate:300,orientation:"vertical",min:l.invSliderVal(p),max:l.invSliderVal(b),value:d,start:function(){l.sliderActive=true},stop:function(){l.sliderActive=false},change:function(){},slide:function(a,k){q.setZoomLevel(l.invSliderVal(k.value))}})}},
getEventDateLine:function(d){var l="<span class='timeglider-dateline-startdate'>"+d.startdateObj.format("",true,q.timeOffset)+"</span>",p="";if(d.span==true)p=" &ndash; <span class='timeglider-dateline-enddate'>"+d.enddateObj.format("",true,q.timeOffset)+"</span>";return l+p},eventHover:function(d,l){var p=j(".timeglider-event-hover-info");l.date_display!="no"&&p.position({my:"left bottom",at:"left top",of:d,offset:"1, -10",collision:"flip flip"}).html(this.getEventDateLine(l));d.addClass("tg-event-hovered")},
eventUnHover:function(d){j(".timeglider-event-hover-info").css("left","-1000px");d.removeClass("tg-event-hovered")},clearTicks:function(){this.tickNum=this.leftside=0;j(t).css("left",0);j(n+" .tg-timeline-envelope").remove();j(n+" .timeglider-tick").remove()},castTicks:function(){this.clearTicks();q.getZoomLevel();var d=q.getFocusDate(),l=q.getZoomInfo().width;l=Math.ceil(this.dimensions.container.width/l)+4;var p="l";q.setTicksReady(false);this.addTick({type:"init",focus_date:d});for(d=1;d<=l;d+=
1){this.addTick({type:p});p=p=="l"?"r":"l"}q.setTicksReady(true);this.displayFocusDate()},addTick:function(d){var l=0,p=0,b=p=0,a=0,k=0,g=k="",i={};k={};b={};var h={};k={};i="";h=q.getZoomInfo().unit;var r=q.getZoomInfo().width;a=q.getFocusDate();b=parseInt(this.dimensions.tick.top);a=q.addToTicksArray({type:d.type,unit:h},a);if(h=="mo"){k=D.getMonthAdj(a,r);r=k.width;l=k.days}this.tickNum++;if(d.type=="init"){k=this.tickOffsetFromDate(q.getZoomInfo(),q.getFocusDate(),r);this.leftside=p=Math.ceil(this.dimensions.container.centerx+
k);this.rightside=p+r}else if(d.type=="l")this.leftside=p=Math.floor(this.leftside-r);else if(d.type=="r"){p=Math.floor(this.rightside);this.rightside+=r}q.getTickBySerial(a).width=r;q.getTickBySerial(a).left=p;k=this._views.PLACE+"_"+h+"_"+a+"-"+this.tickNum;k=j("<div class='timeglider-tick' id='"+k+"'><div class='timeglider-tick-label' id='label'></div></div>").appendTo(t);k.css({width:r,left:p,top:b});b=this.getTickMarksInfo({unit:h,width:r});b=l||b.tperu;p=r/b;if(p>5)for(d=l=0;d<b;d++){g="&nbsp;";
if(p>16)if(h=="da")g=this.getHourLabelFromHour(d,p);else if(h=="mo")g=d+1;else if(h=="ye")g=p>30?"&nbsp;"+D.monthNamesAbbr[d+1]:"&nbsp;"+D.monthNamesLet[d+1];else if(h=="de"){if(p>44)g=a+""+d}else if(h=="ce")if(p>28)g=a+""+d+"0";i+="<div class='timeglider-tick-sub-label' style='left:"+l+"px;width:"+p+"px'>"+g+"</div>";l+=p}i&&k.append("<div style='background-color:none;height:24px;width:"+(r+10)+"px;position:absolute;top:15px;left:0;overflow:hidden'>"+i+"</div>");h={unit:h,width:r,serial:a};i=this.getDateLabelForTick(h);
k.children("#label").text(i);return h},setCenterline:function(){q.options.show_centerline===true?j(this._views.CENTERLINE).css({height:this.dimensions.container.height,left:this.dimensions.container.centerx}):j(this._views.CENTERLINE).css({display:"none"})},getHourLabelFromHour:function(d,l){var p="",b=d,a="";a=0;if(l<16)return"";else{if(d>12)b=d-12;else if(d==0)b=12;if(l>30)p=d>11?" pm":" am";if(l>200){a=l/4-4;return"<div class='minutes' style='width:"+a+"px'>"+b+":00 "+p+"</div><div class='minutes' style='width:"+
a+"px'>"+b+":15 "+p+"</div><div class='minutes' style='width:"+a+"px'>"+b+":30 "+p+"</div><div class='minutes' style='width:"+a+"px'>"+b+":45 "+p+"</div>"}else return b+(l>60?":00":"")+p}},getTickMarksInfo:function(d){switch(d.unit){case "da":d=24;break;case "mo":d=30;break;case "ye":d=12;break;default:d=10}return{tperu:d}},getDateLabelForTick:function(d){var l=d.serial,p=d.width;switch(d.unit){case "bill":return l==0?"1":l>0?l+" billion":l+" b.y. bce";case "hundredmill":return l==0?"1":l>0?l+"00 million":
l+"00 m.y. bce";case "tenmill":return l==0?"1":l>0?l+"0 million":l+"0 m.y. bce";case "mill":return l==0?"1":l>0?l+" million":l+" m.y. bce";case "hundredthou":return l==0?"1":l>0?l+"00,000":l+"00,000 bce";case "tenthou":return l==0?"1":l>0?l+"0,000":l+"0,000 bce";case "thou":return l==0?"1("+l+")":l>0?l+"000":l+"000 bce";case "ce":return l==0?"1("+l+")":l>0?l+"00":l+"00 bce";case "de":return l>120?l*10+"s":l*10;case "ye":return l;case "mo":d=D.getDateFromMonthNum(l);return p<120?D.monthNamesAbbr[d.mo]+
" "+d.ye:D.monthNames[d.mo]+", "+d.ye;case "da":d=new D(D.getDateFromRD(l));return p<120?D.monthNamesAbbr[d.mo]+" "+d.da+", "+d.ye:D.monthNames[d.mo]+" "+d.da+", "+d.ye;default:return d.unit+":"+l+":"+p}},tickHangies:function(){var d=j(t).position().left,l=this.rightside+d-this.dimensions.container.width;if(this.leftside+d>-100){d=this.addTick({type:"l"});this.appendTimelines(d)}else if(l<100){d=this.addTick({type:"r"});this.appendTimelines(d)}},tickOffsetFromDate:function(d,l,p){switch(d.unit){case "da":l=
l.ho/24+l.mi/1440;p*=l;break;case "mo":d=D.getMonthDays(l.mo,l.ye);l=(l.da-1)/d+l.ho/(24*d)+l.mi/(1440*d);p*=l;break;case "ye":l=((l.mo-1)*30+l.da)/365;p*=l;break;case "de":l=l.ye%10/10+l.mo/120;p*=l;break;case "ce":l=l.ye%100/100+l.mo/1200;p*=l;break;case "thou":l=l.ye%1E3/1E3;p*=l;break;case "tenthou":l=l.ye%1E4/1E4;p*=l;break;case "hundredthou":l=l.ye%1E5/1E5;p*=l;break;default:p=0}return-1*p},resetTicksHandle:function(){j(this._views.HANDLE).offset({left:j(n).offset().left})},easeOutTicks:function(){Math.abs(z)>
5&&j(t).animate({left:"+="+3*z},1E3,"easeOutQuad",function(){debug.trace("stopping easing","note")})},getTimelineEventsByTick:function(d){var l=d.tick.unit,p=d.tick.serial;d=q.eventCollection.getTimelineHash(d.timeline.timeline_id);return d[l][p]&&d[l][p].length>0?d[l][p]:0},passesFilters:function(d,l){var p=true,b="",a=[],k;b="";a=[];if(l<d.low_threshold||l>d.high_threshold)return false;if(b=q.filters.include){a=b.split(",");p=false;for(k=0;k<a.length;k++){b=RegExp(j.trim(a[k]),"i");if(d.title.match(b))p=
true}}if(b=q.filters.exclude){a=b.split(",");for(k=0;k<a.length;k++){b=RegExp(j.trim(a[k]),"i");if(d.title.match(b))p=false}}b=d.icon;if(q.filters.legend.length>0)if(j.inArray(b,q.filters.legend)==-1)p=false;return p},freshTimelines:function(){var d=this,l,p,b,a=q.activeTimelines,k=q.ticksArray,g="",i,h;p="";var r=d.dimensions.container.centerx;l=d.dimensions.container.width;var u=q.getFocusDate().sec,B=q.getZoomInfo().spp;q.getZoomInfo();p=[];var c=[],f=u-Math.floor(B*(l/2));b=i=0;for(var m,x=0,
C=d.dimensions.container.height,F=x=0;F<a.length;F++){c=[];p=q.timelineCollection.get(a[F]);l=p.attributes;m=l.display;x=l.top?parseInt(l.top.replace("px","")):C-d.initTimelineVOffset;p=new s.TG_TimelineView({model:p});i=q.timeOffset.seconds/B;h=j(p.render().el).appendTo(t);h.draggable({axis:"y",handle:".titleBar",stop:function(){var I=j(this).css("top"),M=j(this).attr("id");q.timelineCollection.get(M).set({top:I});q.refresh()}}).css({top:x,left:i});i=h.find(".titleBar");if(typeof l.bounds!="undefined"){p=
r+(l.bounds.first-u)/B;b=r+(l.bounds.last-u)/B}else{p=r;b=r+300}b-=p;i.css({top:void 0,left:p,width:b}).data({lef:p,wid:b});if(m=="expanded")l.borg=g=new timeglider.TG_Org;for(i=0;i<k.length;i++){p=this.getTimelineEventsByTick({tick:k[i],timeline:l});j.merge(c,p)}_.each(l.spans,function(I){I.start<f&&I.end>f&&j.inArray(I.id,c)==-1&&c.unshift(I.id)});p=this.compileTickEventsAsHtml(l,c,0,"sweep");x=E.event_overflow=="scroll"?0:l.hasImagesAbove?x-d.imageLaneHeight:x;if(m=="expanded"){p=g.getHTML("sweep",
x);l.borg=g.getBorg()}p!="undefined"&&h.append(p.html);setTimeout(function(){d.registerEventImages(h)},3)}d.registerTitles();j.publish("viewer.rendered")},appendTimelines:function(d){var l=q.activeTimelines,p=[],b;p="";for(var a=0;a<l.length;a++){b=q.timelineCollection.get(l[a]).attributes;debug.log("tl id:",b.id);p=this.getTimelineEventsByTick({tick:d,timeline:b});p=this.compileTickEventsAsHtml(b,p,d.serial,"append");if(b.display=="expanded")p=b.borg.getHTML(d.serial,b.top);b=j(n+" .tg-timeline-envelope#"+
b.id).append(p.html);this.registerEventImages(b)}j.publish("viewer.rendered")},compileTickEventsAsHtml:function(d,l,p,b){var a=0,k=this.dimensions.container.centerx,g=d.display,i="",h=q.startSec,r=q.getZoomInfo().spp,u=q.getZoomInfo().level,B=a=0,c=d.borg,f={},m="sweep";if(b=="append")m=p;for(p=0;p<l.length;p++){f=q.eventCollection.get(l[p]).attributes;if(this.passesFilters(f,u)===true){a=k+(f.startdateObj.sec-h)/r;if(g=="expanded"){b=d.size_importance!==false?this.scaleToImportance(f.importance,
u):1;f.width=f.titleWidth*b+20;f.fontsize=this.basicFontSize*b;f.left=a;f.spanwidth=0;if(f.span==true){f.spanwidth=(f.enddateObj.sec-f.startdateObj.sec)/r;if(f.spanwidth>f.width)f.width=f.spanwidth}a=Math.ceil(f.fontsize);f.height=a+2;f.top=0-a;if(f.image&&f.image.display_class==="inline"){b=(f.image.scale||100)/100;a=b*f.image.height+2;B=b*f.image.width+2;f.shape={img_ht:a,img_wi:B,top:f.top-a,bottom:f.top-4,left:f.left,right:f.left+B}}else f.shape=null;c.addBlock(f,m)}else if(g=="collapsed")i+=
"<div id='"+f.id+"' class='timeglider-event-collapsed' style='top:-2px;left:"+a+"px'></div>"}}return g=="collapsed"?i:""},registerEventImages:function(d){j(n+" .timeglider-event-image-bar").each(function(){j(this).position({my:"top",at:"bottom",of:d,offset:"0, 0"}).css("left",0)});j(n+" .timeglider-event-image-above").each(function(){j(this).css("display","block").position({my:"top",at:"top",of:j(n),offset:"0, 12"}).css({left:0})})},expandCollapseTimeline:function(d){d=q.timelineCollection.get(d).attributes;
d.display=d.display=="expanded"?"collapsed":"expanded";q.refresh()},openTimelineModal:function(d){d=new this.timelineModal({model:q.timelineCollection.get(d)});j(d.render().el).appendTo("body").position({my:"left top",at:"left top",of:this._views.CONTAINER,offset:"32, 32",collision:"fit fit"}).css("z-index",this.ztop++).draggable({stack:".timeglider-modal"})},createEventLinksMenu:function(d){if(!d)return"";var l="",p=0,b="",a="";if(typeof d=="string")l="<li><a href='"+d+"' target='_blank'>link</a></li>";
else if(typeof d=="object")for(p=0;p<d.length;p++){b=d[p].url;a=d[p].label;l+="<li><a href='"+b+"' target='_blank'>"+a+"</a></li>"}return l},eventModal:function(d){j(n+" #"+d+"_modal").remove();var l=this,p=false,b=false,a="";a={};a=0;a=j("#"+d);var k=q.eventCollection.get(d).attributes,g=k.modal_type||E.event_modal.type,i=k.image&&k.image.src?"<img src='"+k.image.src+"'>":"",h=this.createEventLinksMenu(k.link);d={title:k.title,description:k.description,id:d,dateline:l.getEventDateLine(k),links:h,
image:i};if(k.video){d.video=k.video;g="full";b=true;d.video=k.video}else if(k.map&&k.map.latlong){p=true;g="full"}switch(g){case "full":d=j.tmpl(l._templates.event_modal_full,d);d.appendTo(n).css({"z-index":l.ztop++}).position({my:"left top",at:"left top",of:n,offset:"0, 0",collision:"none none"});if(p==true){d.find("#insert").append("<div id='map_modal_map'></div>");a=k.map.zoom||12;p=String(k.map.latlong).split(",");p=new google.maps.LatLng(parseFloat(p[0]),parseFloat(p[1]));a={zoom:a,center:p,
mapTypeId:google.maps.MapTypeId.ROADMAP};a=new google.maps.Map(j("#map_modal_map")[0],a);if(k.map.markers)for(p=0;p<k.map.markers.length;p++){b=k.map.markers[p];new google.maps.MarkerImage(b.image,new google.maps.Size(24,32),new google.maps.Point(0,0),new google.maps.Point(0,32));d=b.latlong.split(",");d=new google.maps.LatLng(d[0],d[1]);b=new google.maps.Marker({position:d,map:a,icon:b.icon,title:b.title,zIndex:b.zIndex})}}else b==true&&d.find("#insert").append("<iframe width='100%' height='300' src='"+
k.video+"'></iframe></div>");k=l.dimensions.container.height;p=l.dimensions.container.width;b=j(n+" .full_modal_panel");d=b.width();a=b.height();b.css({top:(k-a)/2+"px",left:(p-d)/2+"px"});break;case "video":d=j.tmpl(l._templates.event_modal_video,d);d.appendTo(t).css("z-index",l.ztop++).position({my:"right center",at:"left center",of:a,offset:"-12, -1",collision:"flip fit"}).hover(function(){j(this).css("z-index",l.ztop++)});break;default:d=j.tmpl(l._templates.event_modal_small,d);d.appendTo(t).css("z-index",
l.ztop++).position({my:"center top",at:"center top",of:n,offset:"0, 100",collision:"fit fit"}).draggable().hover(function(){j(this).css("z-index",l.ztop++)})}},legendModal:function(d){var l=q.timelineCollection.get(d).attributes.legend,p=0,b="",a="",k="";p="";for(p=0;p<l.length;p++){b=E.icon_folder+l[p].icon;a=l[p].title;k+="<li><img class='legend-icon' src='"+b+"'><span class='legend-info'>"+a+"</span></li>"}d={id:d,legend_list:k};j(n+" .timeglider-legend").remove();j.tmpl(this._templates.legend_modal,
d).appendTo(n).css("z-index",this.ztop++).toggleClass("timeglider-display-none").position({my:"left top",at:"left top",of:n,offset:"16, -4",collision:"none none"});p=timeglider.mode==="authoring"?n+" .legend-info":n+" .legend-info, "+n+" .legend-icon";j(p).bind("mouseup",function(g){g=j(g.target).parent().children("img").attr("src");j(this).parent().toggleClass("tg-legend-icon-selected");q.setFilters({origin:"legend",icon:g})})},parseHTMLTable:function(d){var l={},p=+new Date,b=[];j("#"+d).find("tr").each(function(a){var k=
j(this).children(),g;if(a===0)b=k.map(function(){return j(this).attr("class").replace(/^.*?\btg-(\S+)\b.*?$/,"$1")}).get();else{g={};k.each(function(i){g[b[i]]=j(this).text()});l["prefix"+p++]=g}});return l}};s.TG_TimelineView=Backbone.View.extend({initialize:function(){var d=this;this.model.bind("change:title",function(){j(d.el).find(".timeline-title-span").text(d.model.get("title"))});this.model.bind("destroy",this.remove,this)},tagName:"div",events:{"click .timeline-title-span":"titleClick"},className:"tg-timeline-envelope",
getTemplate:function(){var d="<div class='titleBar'><div class='timeline-title'><span class='timeline-title-span'>${title}</span><div class='tg-timeline-env-buttons'>";if(this.model.get("description"))d+="<span class='timeline-info' data-timeline_id='${id}'>info</span>";if(this.model.get("hasLegend"))d+="<span class='tg-timeline-legend-bt' data-timeline_id='${id}'>legend</span>";d+="<span class='expand-collapse' data-timeline_id='${id}'>exp/col</span>";d+="</div></div></div>";return d},render:function(){this.model.get("id");
this.model.get("title");var d=this.getTemplate();j(this.el).html(j.tmpl(d,this.model.attributes)).attr("id",this.model.get("id"));return this},setText:function(){},titleClick:function(){q.timelineTitleClick(this.model.get("id"))},remove:function(){j(this.el).remove()}});s.zoomTree=[{},{unit:"da",width:35E3,level:1,label:"5 hours"},{unit:"da",width:17600,level:2,label:"7 hours"},{unit:"da",width:8800,level:3,label:"10 hours"},{unit:"da",width:4400,level:4,label:"12 hours"},{unit:"da",width:2200,level:5,
label:"14 hours"},{unit:"da",width:1100,level:6,label:"17 hours"},{unit:"da",width:550,level:7,label:"22 hours"},{unit:"da",width:432,level:8,label:"1 DAY"},{unit:"da",width:343,level:9,label:"1.5 days"},{unit:"da",width:272,level:10,label:"2 days"},{unit:"da",width:216,level:11,label:"2.5 days"},{unit:"da",width:171,level:12,label:"3 days"},{unit:"da",width:136,level:13,label:"3.5 days"},{unit:"da",width:108,level:14,label:"4 days"},{unit:"mo",width:2509,level:15,label:"6 days"},{unit:"mo",width:1945,
level:16,label:"1 WEEK"},{unit:"mo",width:1508,level:17,label:"10 days"},{unit:"mo",width:1169,level:18,label:"2 weeks"},{unit:"mo",width:913,level:19,label:"2.5 weeks"},{unit:"mo",width:719,level:20,label:"3 weeks"},{unit:"mo",width:566,level:21,label:"3.5 weeks"},{unit:"mo",width:453,level:22,label:"1 MONTH"},{unit:"mo",width:362,level:23,label:"5.5 weeks"},{unit:"mo",width:290,level:24,label:"7 weeks"},{unit:"mo",width:232,level:25,label:"2 months"},{unit:"mo",width:186,level:26,label:"2.5 months"},
{unit:"mo",width:148,level:27,label:"3 months"},{unit:"mo",width:119,level:28,label:"4 months"},{unit:"mo",width:95,level:29,label:"5 months"},{unit:"mo",width:76,level:30,label:"6 months"},{unit:"ye",width:723,level:31,label:"9 months"},{unit:"ye",width:573,level:32,label:"1 YEAR"},{unit:"ye",width:455,level:33,label:"1.25 years"},{unit:"ye",width:361,level:34,label:"1.5 years"},{unit:"ye",width:286,level:35,label:"2 years"},{unit:"ye",width:227,level:36,label:"2.5 years"},{unit:"ye",width:179,level:37,
label:"3 years"},{unit:"ye",width:142,level:38,label:"4 years"},{unit:"ye",width:113,level:39,label:"5 years"},{unit:"ye",width:89,level:40,label:"6 years"},{unit:"de",width:705,level:41,label:"8 years"},{unit:"de",width:559,level:42,label:"10 years"},{unit:"de",width:443,level:43,label:"13 years"},{unit:"de",width:302,level:44,label:"16 years"},{unit:"de",width:240,level:45,label:"20 years"},{unit:"de",width:190,level:46,label:"25 years"},{unit:"de",width:150,level:47,label:"30 years"},{unit:"de",
width:120,level:48,label:"40 years"},{unit:"de",width:95,level:49,label:"50 years"},{unit:"de",width:76,level:50,label:"65 years"},{unit:"ce",width:600,level:51,label:"80 years"},{unit:"ce",width:480,level:52,label:"100 years"},{unit:"ce",width:381,level:53,label:"130 years"},{unit:"ce",width:302,level:54,label:"160 years"},{unit:"ce",width:240,level:55,label:"200 years"},{unit:"ce",width:190,level:56,label:"250 years"},{unit:"ce",width:150,level:57,label:"300 years"},{unit:"ce",width:120,level:58,
label:"400 years"},{unit:"ce",width:95,level:59,label:"500 years"},{unit:"ce",width:76,level:60,label:"600 years"},{unit:"thou",width:603,level:61,label:"1000 years"},{unit:"thou",width:478,level:62,label:"1200 years"},{unit:"thou",width:379,level:63,label:"1800 years"},{unit:"thou",width:301,level:64,label:"160 years"},{unit:"thou",width:239,level:65,label:"xxx years"},{unit:"thou",width:190,level:66,label:"xxx years"},{unit:"thou",width:150,level:67,label:"xxx years"},{unit:"thou",width:120,level:68,
label:"xxx years"},{unit:"thou",width:95,level:69,label:"8,000 years"},{unit:"thou",width:76,level:70,label:"10,000 years"},{unit:"tenthou",width:603,level:71,label:"15,000 years"},{unit:"tenthou",width:358,level:72,label:"20,000 years"},{unit:"tenthou",width:213,level:73,label:"30,000 years"},{unit:"tenthou",width:126,level:74,label:"60,000 years"},{unit:"tenthou",width:76,level:75,label:"100,000 years"},{unit:"hundredthou",width:603,level:76,label:"180,000 years"},{unit:"hundredthou",width:358,
level:77,label:"300,000 years"},{unit:"hundredthou",width:213,level:78,label:"500,000 years"},{unit:"hundredthou",width:126,level:79,label:"800,000 years"},{unit:"hundredthou",width:76,level:80,label:"1 million years"},{unit:"mill",width:603,level:81,label:"1.2 million years"},{unit:"mill",width:358,level:82,label:"2 million years"},{unit:"mill",width:213,level:83,label:"3 million years"},{unit:"mill",width:126,level:84,label:"5 million years"},{unit:"mill",width:76,level:85,label:"10 million years"},
{unit:"tenmill",width:603,level:86,label:"15 million years"},{unit:"tenmill",width:358,level:87,label:"30 million years"},{unit:"tenmill",width:213,level:88,label:"50 million years"},{unit:"tenmill",width:126,level:89,label:"80 million years"},{unit:"tenmill",width:76,level:90,label:"100 million years"},{unit:"hundredmill",width:603,level:91,label:"120 million years"},{unit:"hundredmill",width:358,level:92,label:"200 million years"},{unit:"hundredmill",width:213,level:93,label:"300 million years"},
{unit:"hundredmill",width:126,level:94,label:"500 million years"},{unit:"hundredmill",width:76,level:95,label:"1 billion years"},{unit:"bill",width:603,level:96,label:"15 million years"},{unit:"bill",width:358,level:97,label:"30 million years"},{unit:"bill",width:213,level:98,label:"50 million years"},{unit:"bill",width:126,level:99,label:"80 million years"},{unit:"bill",width:76,level:100,label:"100 billion years"}];s.calculateSecPerPx=function(d){for(var l=1;l<d.length;l++){var p=d[l],b=0;switch(p.unit){case "da":b=
86400;break;case "mo":b=2419200;break;case "ye":b=31536E3;break;case "de":b=31536E4;break;case "ce":b=31536E5;break;case "thou":b=31536E6;break;case "tenthou":b=31536E7;break;case "hundredthou":b=31536E8;break;case "mill":b=31536E9;break;case "tenmill":b=31536E10;break;case "hundredmill":b=31536E11;break;case "bill":b=31536E12}p.spp=b/parseInt(p.width)}}(s.zoomTree);s.getStringWidth=function(d){if(d)return j("#timeglider-measure-span").html(d).width()};String.prototype.removeWhitespace=function(){return this.replace(RegExp("\\n",
"g"),"")};if(debug)debug.trace=function(d,l){j("#"+l).text(d)};s.googleMapsInit=function(){};s.googleMapsLoaded=false;s.googleMapsLoad=function(){if(s.googleMapsLoaded==false){var d=document.createElement("script");d.type="text/javascript";d.src="http://maps.googleapis.com/maps/api/js?sensor=false&callback=timeglider.googleMapsInit";document.body.appendChild(d);s.googleMapsLoaded=true}}})(timeglider);(function(s){var D={},A=s.TG_Date,q={},E=jQuery,z={},H="";s.TG_Mediator=function(v,o){this.options=q=v;z=o;H=v.base_namespace+"#"+z.attr("id");this._focusDate={};this._zoomInfo={};this._zoomLevel=1;this.ticksReady=false;this.ticksArray=[];this.startSec=0;this.activeTimelines=[];this.max_zoom=q.max_zoom;this.min_zoom=q.min_zoom;this.icon_folder=s.icon_folder=q.icon_folder||"js/timeglider/icons/";this.timeOffset=A.getTimeOffset(q.timezone);this.fixed_zoom=this.max_zoom==this.min_zoom?true:false;this.gesturing=
false;this.gestureStartScale=this.gestureStartZoom=0;this.filters={include:"",exclude:"",legend:[]};this.timelineCollection=new s.TG_TimelineCollection;this.eventCollection=new s.TG_EventCollection;this.imagesToSize=this.imagesSized=0;this.timelineDataLoaded=false;this.initial_timeline_id=q.initial_timeline_id||"";this.sole_timeline_id="";this.dimensions={};this.focusedEvent="";if(q.max_zoom===q.min_zoom)this.fixed_zoom=q.min_zoom;if(q.main_map){this.main_map=q.main_map;timeglider.mapping.setMap(this.main_map,
this)}D=this};s.TG_Mediator.prototype={focusToEvent:function(v){this.focusedEvent=v;this.setFocusDate(v.startdateObj);E.publish(H+".mediator.focusToEvent")},gotoDateZoom:function(v,o){var j=false;this.setFocusDate(new A(v));if(o)j=this.setZoomLevel(o);if(!o||j==false)this.refresh()},zoom:function(v){this.setZoomLevel(this.getZoomLevel()+parseInt(v))},getScope:function(){var v=this.getZoomInfo(),o=this.getFocusDate(),j=this.getActiveTimelinesBounds();return{spp:Math.round(v.spp),width:this.dimensions.container.width,
focusDateSec:Math.round(o.sec),timelines:this.activeTimelines,timelineBounds:j,container:z}},getActiveTimelinesBounds:function(){for(var v=this.activeTimelines,o={},j=99999999999,w=0,e=0;e<v.length;e++){o=this.timelineCollection.get(v[e]);j=o.get("bounds").first<j?o.get("bounds").first:j;w=o.get("bounds").last>w?o.get("bounds").last:w}return{first:j,last:w}},loadTimelineData:function(v){var o=this;if(v)if(typeof v==="object")o.parseTimelineData(v);else if(v.substr(0,1)=="#"){v=[o.getTableTimelineData(v)];
o.parseTimelineData(v)}else E.getJSON(v,function(j){o.parseTimelineData(j)});else{this.timelineDataLoaded=true;this.setZoomLevel(Math.floor((this.max_zoom+this.min_zoom)/2));this.tryLoading()}},mapMarkerClick:function(v){this.focusToEvent(v)},getTimelineCollection:function(){return this.timelineCollection},timelineTitleClick:function(v){E.publish(H+".mediator.timelineTitleClick",{timeline_id:v})},getTableTimelineData:function(v){var o={},j=0,w=[],e,n,t="",y=E(v);o.id=v.substr(1);o.title=y.attr("title")||
"untitled";o.description=y.attr("description")||"";o.focus_date=y.attr("focus_date")||A.getToday;o.initial_zoom=y.attr("initial_zoom")||20;o.events=[];y.find("tr").each(function(G){var d=E(this).children(),l;if(G===0)w=d.map(function(){return E(this).attr("class").replace(/^.*?\btg-(\S+)\b.*?$/,"$1")}).get();else{l={};d.each(function(p){e=w[p];n=e=="description"?E(this).html():E(this).text();l[e]=n});t="ev_"+j++;l.id=t;o.events.push(l)}});y.css("display","none");return o},parseTimelineData:function(v){debug.log("parseTimelineData json...",
v);var o=0,j=v.length,w={};w={};for(var e=0;e<j;e++){w=v[e];w.mediator=this;w=(new s.TG_Timeline(w)).toJSON();if(w.id.length>0){o++;this.swallowTimeline(w)}}if(o===0)alert("ERROR loading data: Check JSON with jsonLint");else{this.timelineDataLoaded=true;this.tryLoading()}},tryLoading:function(){var v=this.timelineDataLoaded==true;if(this.imagesSized==this.imagesToSize&&v){this.setInitialTimelines();E.publish(H+".mediator.timelineDataLoaded")}},swallowTimeline:function(v){debug.log("swallow:",v);this.sole_timeline_id=
v.id;this.timelineCollection.add(v);E.publish(H+".mediator.timelineListChangeSignal")},setInitialTimelines:function(){var v=this,o=this.initial_timeline_id,j="";if(typeof o=="object"){j=this.initial_timeline_id[0];_.each(o,function(w){v.activeTimelines.push(w)})}else if(o.length>0){j=this.initial_timeline_id||this.sole_timeline_id;v.activeTimelines=[j]}else if(this.timelineCollection.length>0){j=this.timelineCollection.pluck("id")[0];v.activeTimelines=[j]}if(timeglider.mode=="authoring")v.setZoomLevel(40);
else j?setTimeout(function(){var w=v.timelineCollection.get(j),e=w.get("focusDateObj");v.setFocusDate(e);v.setZoomLevel(w.get("initial_zoom"))},1E3):v.setZoomLevel(40)},refresh:function(){this.startSec=this._focusDate.sec;E.publish(H+".mediator.refreshSignal")},setTicksReady:function(v){this.ticksReady=v;v===true&&E.publish(H+".mediator.ticksReadySignal")},setTimeoffset:function(v){this.timeOffset=A.getTimeOffset(v);this.refresh()},getTimeoffset:function(){return this.timeOffset},setDimensions:function(v){this.dimensions=
v},setFocusDate:function(v){if(v!=this._focusDate)this._focusDate=v},getFocusDate:function(){return this._focusDate},getZoomLevel:function(){return parseInt(this._zoomLevel)},setZoomLevel:function(v){if(v<=this.max_zoom&&v>=this.min_zoom){this.startSec=this._focusDate.sec;if(v!=this._zoomLevel){this._zoomLevel=v;this._zoomInfo=s.zoomTree[v];E.publish(H+".mediator.zoomLevelChange");E.publish(H+".mediator.scopeChange");return true}else return false}else return false},getZoomInfo:function(){return this._zoomInfo},
registerUIEvent:function(v){switch(v.name){case "dblclick":v=v.event.pageX-v.dimensions.container.offset.left-v.dimensions.container.width/2;var o=this.getZoomInfo().spp,j=this.getFocusDate().sec;v=new A(Math.floor(j+v*o));E.publish(H+".mediator.dblclick",{date:v})}},setFilters:function(v){switch(v.origin){case "clude":this.filters.include=v.include;this.filters.exclude=v.exclude;break;case "legend":var o=v.icon.replace(this.options.icon_folder,"");if(o=="all"){this.filters.legend=[];E.publish(H+
".mediator.legendAll")}else if(E.inArray(o,this.filters.legend)==-1)this.filters.legend.push(o);else{v=[];v=E.grep(this.filters.legend,function(j){return j!=o});this.filters.legend=v}}E.publish(H+".mediator.filtersChange");E.publish(H+".mediator.scopeChange");this.refresh()},getTicksOffset:function(){return this._ticksOffset},setTicksOffset:function(v){this._ticksOffset=v;E.publish(H+".mediator.ticksOffsetChange");E.publish(H+".mediator.scopeChange")},getTickBySerial:function(v){for(var o=this.ticksArray,
j=o.length,w=0;w<j;w++){var e=o[w];if(e.serial==v)return e}return false},addToTicksArray:function(v,o){if(v.type=="init"){v.serial=A.getTimeUnitSerial(o,v.unit);this.ticksArray=[v]}else if(v.type=="l"){v.serial=this.ticksArray[0].serial-1;this.ticksArray.unshift(v)}else{v.serial=this.ticksArray[this.ticksArray.length-1].serial+1;this.ticksArray.push(v)}E.publish(H+".mediator.ticksArrayChange");return v.serial},toggleTimeline:function(v){var o=this.timelineCollection.get(v).attributes,j=E.inArray(v,
this.activeTimelines);if(j==-1){this.activeTimelines.push(v);this.setFocusDate(new A(o.focus_date));this.setZoomLevel(o.initial_zoom)}else{this.activeTimelines.splice(j,1);this.refresh()}E.publish(H+".mediator.activeTimelinesChange")},reportImageSize:function(v){var o=D.eventCollection.get(v.id);if(o.has("image")){if(v.error){o.attributes.image={};debug.log("WHOOPS: MISSING IMAGE: "+v.src)}else{o.attributes.image.width=v.width;o.attributes.image.height=v.height}this.imagesSized++;this.imagesSized==
this.imagesToSize&&this.tryLoading()}}};s.getLowHigh=function(v){v=_.sortBy(v,function(o){return parseInt(o)});return{low:_.first(v),high:_.last(v)}};s.validateOptions=function(v){this.optionsMaster={initial_focus:{type:"date"},timezone:{type:"timezone"},editor:{type:"string"},backgroundColor:{type:"color"},backgroundImage:{type:"color"},min_zoom:{type:"number",min:1,max:100},max_zoom:{type:"number",min:1,max:100},initial_zoom:{type:"number",min:1,max:100},show_centerline:{type:"boolean"},display_zoom_level:{type:"boolean"},
data_source:{type:"url"},basic_fontsize:{type:"number",min:9,max:100},mouse_wheel:{type:"string",possible:["zoom","pan"]},initial_timeline_id:{type:"mixed"},icon_folder:{type:"string"},show_footer:{type:"boolean"},display_zoom_level:{type:"boolean"},event_modal:{type:"object"},event_overflow:{type:"string"}};var o=this,j="";E.each(v,function(w,e){if(o.optionsMaster[w])switch(o.optionsMaster[w].type){case "string":if(typeof e!="string")j+=w+" needs to be a string.\n";if(o.optionsMaster[w].possible)if(E.inArray(e,
o.optionsMaster[w].possible)==-1)j+=w+" must be: "+o.optionsMaster[w].possible.join(" or ");break;case "number":if(typeof e!="number")j+=e+" needs to be a number.\n";if(o.optionsMaster[w].min)if(e<o.optionsMaster[w].min)j+=w+" must be greater than or equal to "+o.optionsMaster[w].min+"\n";if(o.optionsMaster[w].max)if(e>o.optionsMaster[w].max)j+=w+" must be less than or equal to "+o.optionsMaster[w].max+"\n";break;case "timezone":var n=/[+|-]?[0-9]+:[0-9]+/;if(E.inArray(e,["New York","Denver","Chicago",
"Los Angeles"])==-1&&e.match(n)==-1)j+="The timezone is not formatted properly";break;case "boolean":if(typeof e!="boolean")j+=e+" needs to be a number.\n"}});return j}})(timeglider);(function(s){var D,A,q=timeglider,E=timeglider.TG_Date;s.widget("timeglider.timeline",{options:{base_namespace:"tg",timezone:"00:00",initial_focus:q.TG_Date.getToday(),editor:"none",min_zoom:1,max_zoom:100,show_centerline:true,data_source:"",culture:"en",basic_fontsize:12,mouse_wheel:"zoom",initial_timeline_id:"",icon_folder:"js/timeglider/icons/",show_footer:true,display_zoom_level:true,event_modal:{href:"",type:"default"},event_overflow:"plus"},_create:function(){this._id=s(this.element).attr("id");
this.element.html("<div class='timeglider-container'><div class='timeglider-loading'>loading</div><div class='timeglider-centerline'></div><div class='timeglider-date-display'></div><div class='timeglider-truck' id='tg-truck'><div class='timeglider-ticks'><div class='timeglider-handle'></div></div></div><div class='timeglider-slider-container'><div class='timeglider-slider'></div><div class='timeglider-pan-buttons'><div class='timeglider-pan-left'></div><div class='timeglider-pan-right'></div></div></div><div class='timeglider-footer'><div class='timeglider-logo'></div><div class='timeglider-footer-button timeglider-filter-bt'></div><div class='timeglider-footer-button timeglider-settings-bt'></div><div class='timeglider-footer-button timeglider-list-bt'></div></div><div class='timeglider-event-hover-info'></div></div><span id='timeglider-measure-span'></span>")},
_init:function(){var z=timeglider.validateOptions(this.options);if(z==""){q.TG_Date.setCulture(this.options.culture);A=new q.TG_Mediator(this.options,this.element);D=new q.TG_PlayerView(this,A);A.setFocusDate(new E(this.options.initial_focus));A.loadTimelineData(this.options.data_source)}else alert("Rats. There's a problem with your widget settings:"+z)},goTo:function(z,H){A.gotoDateZoom(z,H)},resize:function(){D.resize()},getMediator:function(){return A},getScope:function(){return A.getScope()},
zoom:function(z){switch(z){case "in":z=-1;break;case "out":z=1}if(z>99||z<-99)return false;A.zoom(z)},load:function(z){A.loadTimelineData(z)},panButton:function(z,H){var v=0;switch(H){case "left":v=30;break;case "right":v=-30;break;default:v=H}D.setPanButton(z,v)},destroy:function(){s.Widget.prototype.destroy.apply(this,arguments);s(this.element).html("")}})})(jQuery);
